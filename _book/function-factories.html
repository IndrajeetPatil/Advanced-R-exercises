<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>Chapter 10 Function factories | Advanced R Exercises</title>

    <meta name="author" content="Indrajeet Patil" />
  
   <meta name="description" content="My solutions to exercises in Hadley Wickham’s Advanced R (2nd edition) book." />
   <meta name="generator" content="placeholder" />
  <meta property="og:title" content="Chapter 10 Function factories | Advanced R Exercises" />
  <meta property="og:type" content="book" />
  
  <meta property="og:image" content="/cover.png" />
  <meta property="og:description" content="My solutions to exercises in Hadley Wickham’s Advanced R (2nd edition) book." />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 10 Function factories | Advanced R Exercises" />
  
  <meta name="twitter:description" content="My solutions to exercises in Hadley Wickham’s Advanced R (2nd edition) book." />
  <meta name="twitter:image" content="/cover.png" />
  <!-- JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script>
  <script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script>
    <script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet" />
    <script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script>
    <script src="libs/bs3compat-0.4.0/transition.js"></script>
    <script src="libs/bs3compat-0.4.0/tabs.js"></script>
    <script src="libs/bs3compat-0.4.0/bs3compat.js"></script>
    <link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet" />
    <script src="libs/bs4_book-1.0.0/bs4_book.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script>

  <!-- CSS -->
  <style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
      <link rel="stylesheet" href="bs4_style.css" />
  
</head>

<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book">
    <a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Advanced R Exercises</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
      </form>

      <nav aria-label="Table of contents">
        <h2>Table of contents</h2>
        <div id="book-toc"></div>

        <div class="book-extra">
          <p><a id="book-repo" href="#">View book source <i class="fab fa-github"></i></a></li></p>
        </div>
      </nav>
    </div>
  </header>

  <main class="col-sm-12 col-md-9 col-lg-7" id="content">
<div id="function-factories" class="section level1" number="10">
<h1><span class="header-section-number">Chapter 10</span> Function factories</h1>
<p>Attaching the needed libraries:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="function-factories.html#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rlang, <span class="at">warn.conflicts =</span> <span class="cn">FALSE</span>)</span>
<span id="cb20-2"><a href="function-factories.html#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2, <span class="at">warn.conflicts =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<div id="exercises-10.2.6" class="section level3" number="10.0.1">
<h3><span class="header-section-number">10.0.1</span> Exercises 10.2.6</h3>
<hr />
<p><strong>Q1.</strong> The definition of <code>force()</code> is simple:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="function-factories.html#cb21-1" aria-hidden="true" tabindex="-1"></a>force</span>
<span id="cb21-2"><a href="function-factories.html#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; function (x) </span></span>
<span id="cb21-3"><a href="function-factories.html#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; x</span></span>
<span id="cb21-4"><a href="function-factories.html#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;bytecode: 0x14a8f2708&gt;</span></span>
<span id="cb21-5"><a href="function-factories.html#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;environment: namespace:base&gt;</span></span></code></pre></div>
<p>Why is it better to <code>force(x)</code> instead of just <code>x</code>?</p>
<p><strong>A1.</strong> Because of lazy evaluation, argument to a function won’t be evaluated until its value is needed, but sometimes we may want to have eager evaluation.</p>
<p>Using <code>force()</code> makes this intent clearer.</p>
<hr />
<p><strong>Q2.</strong> Base R contains two function factories, <code>approxfun()</code> and <code>ecdf()</code>. Read their documentation and experiment to figure out what the functions do and what they return.</p>
<p><strong>A2.</strong> About the two function factories-</p>
<ul>
<li><code>approxfun()</code></li>
</ul>
<p>This function factory returns a function performing the linear (or constant) interpolation.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="function-factories.html#cb22-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span></span>
<span id="cb22-2"><a href="function-factories.html#cb22-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">10</span>)</span>
<span id="cb22-3"><a href="function-factories.html#cb22-3" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="fu">approxfun</span>(x, y)</span>
<span id="cb22-4"><a href="function-factories.html#cb22-4" aria-hidden="true" tabindex="-1"></a>f</span>
<span id="cb22-5"><a href="function-factories.html#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; function (v) </span></span>
<span id="cb22-6"><a href="function-factories.html#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; .approxfun(x, y, v, method, yleft, yright, f, na.rm)</span></span>
<span id="cb22-7"><a href="function-factories.html#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;bytecode: 0x11c2ff3c0&gt;</span></span>
<span id="cb22-8"><a href="function-factories.html#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;environment: 0x11c2fea90&gt;</span></span>
<span id="cb22-9"><a href="function-factories.html#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="fu">f</span>(x)</span>
<span id="cb22-10"><a href="function-factories.html#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [1] -0.7786629 -0.3894764 -2.0337983 -0.9823731  0.2478901</span></span>
<span id="cb22-11"><a href="function-factories.html#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [6] -2.1038646 -0.3814180  2.0749198  1.0271384  0.4730142</span></span>
<span id="cb22-12"><a href="function-factories.html#cb22-12" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(<span class="fu">f</span>(x), <span class="dv">0</span>, <span class="dv">11</span>)</span></code></pre></div>
<p><img src="Function-factories_files/figure-html/unnamed-chunk-4-1.png" width="100%" /></p>
<ul>
<li><code>ecdf()</code></li>
</ul>
<p>This function factory computes an empirical cumulative distribution function.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="function-factories.html#cb23-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">12</span>)</span>
<span id="cb23-2"><a href="function-factories.html#cb23-2" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="fu">ecdf</span>(x)</span>
<span id="cb23-3"><a href="function-factories.html#cb23-3" aria-hidden="true" tabindex="-1"></a>f</span>
<span id="cb23-4"><a href="function-factories.html#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Empirical CDF </span></span>
<span id="cb23-5"><a href="function-factories.html#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Call: ecdf(x)</span></span>
<span id="cb23-6"><a href="function-factories.html#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  x[1:12] = -1.8793, -1.3221, -1.2392,  ..., 1.1604, 1.7956</span></span>
<span id="cb23-7"><a href="function-factories.html#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="fu">f</span>(<span class="fu">seq</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="dv">2</span>, <span class="at">by =</span> <span class="fl">0.1</span>))</span>
<span id="cb23-8"><a href="function-factories.html#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [1] 0.00000000 0.00000000 0.08333333 0.08333333 0.08333333</span></span>
<span id="cb23-9"><a href="function-factories.html#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [6] 0.08333333 0.08333333 0.16666667 0.25000000 0.25000000</span></span>
<span id="cb23-10"><a href="function-factories.html#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [11] 0.33333333 0.33333333 0.33333333 0.41666667 0.41666667</span></span>
<span id="cb23-11"><a href="function-factories.html#cb23-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [16] 0.41666667 0.41666667 0.50000000 0.58333333 0.58333333</span></span>
<span id="cb23-12"><a href="function-factories.html#cb23-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [21] 0.66666667 0.75000000 0.75000000 0.75000000 0.75000000</span></span>
<span id="cb23-13"><a href="function-factories.html#cb23-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [26] 0.75000000 0.75000000 0.75000000 0.75000000 0.83333333</span></span>
<span id="cb23-14"><a href="function-factories.html#cb23-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [31] 0.83333333 0.83333333 0.91666667 0.91666667 0.91666667</span></span>
<span id="cb23-15"><a href="function-factories.html#cb23-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [36] 0.91666667 0.91666667 0.91666667 1.00000000 1.00000000</span></span>
<span id="cb23-16"><a href="function-factories.html#cb23-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [41] 1.00000000</span></span></code></pre></div>
<hr />
<p><strong>Q3.</strong> Create a function <code>pick()</code> that takes an index, <code>i</code>, as an argument and returns a function with an argument <code>x</code> that subsets <code>x</code> with <code>i</code>.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="function-factories.html#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pick</span>(<span class="dv">1</span>)(x)</span>
<span id="cb24-2"><a href="function-factories.html#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="co"># should be equivalent to</span></span>
<span id="cb24-3"><a href="function-factories.html#cb24-3" aria-hidden="true" tabindex="-1"></a>x[[<span class="dv">1</span>]]</span>
<span id="cb24-4"><a href="function-factories.html#cb24-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-5"><a href="function-factories.html#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="fu">lapply</span>(mtcars, <span class="fu">pick</span>(<span class="dv">5</span>))</span>
<span id="cb24-6"><a href="function-factories.html#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="co"># should be equivalent to</span></span>
<span id="cb24-7"><a href="function-factories.html#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="fu">lapply</span>(mtcars, <span class="cf">function</span>(x) x[[<span class="dv">5</span>]])</span></code></pre></div>
<p><strong>A3.</strong> The desired function:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="function-factories.html#cb25-1" aria-hidden="true" tabindex="-1"></a>pick <span class="ot">&lt;-</span> <span class="cf">function</span>(i) {</span>
<span id="cb25-2"><a href="function-factories.html#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">force</span>(i)</span>
<span id="cb25-3"><a href="function-factories.html#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(x) x[[i]]</span>
<span id="cb25-4"><a href="function-factories.html#cb25-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Testing it with specified test cases:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="function-factories.html#cb26-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>)</span>
<span id="cb26-2"><a href="function-factories.html#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">identical</span>(x[[<span class="dv">1</span>]], <span class="fu">pick</span>(<span class="dv">1</span>)(x))</span>
<span id="cb26-3"><a href="function-factories.html#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span>
<span id="cb26-4"><a href="function-factories.html#cb26-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-5"><a href="function-factories.html#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="fu">identical</span>(</span>
<span id="cb26-6"><a href="function-factories.html#cb26-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lapply</span>(mtcars, <span class="fu">pick</span>(<span class="dv">5</span>)),</span>
<span id="cb26-7"><a href="function-factories.html#cb26-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lapply</span>(mtcars, <span class="cf">function</span>(x) x[[<span class="dv">5</span>]])</span>
<span id="cb26-8"><a href="function-factories.html#cb26-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb26-9"><a href="function-factories.html#cb26-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<hr />
<p><strong>Q4.</strong> Create a function that creates functions that compute the i<sup>th</sup> <a href="http://en.wikipedia.org/wiki/Central_moment">central moment</a> of a numeric vector. You can test it by running the following code:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="function-factories.html#cb27-1" aria-hidden="true" tabindex="-1"></a>m1 <span class="ot">&lt;-</span> <span class="fu">moment</span>(<span class="dv">1</span>)</span>
<span id="cb27-2"><a href="function-factories.html#cb27-2" aria-hidden="true" tabindex="-1"></a>m2 <span class="ot">&lt;-</span> <span class="fu">moment</span>(<span class="dv">2</span>)</span>
<span id="cb27-3"><a href="function-factories.html#cb27-3" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">100</span>)</span>
<span id="cb27-4"><a href="function-factories.html#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">all.equal</span>(<span class="fu">m1</span>(x), <span class="dv">0</span>))</span>
<span id="cb27-5"><a href="function-factories.html#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">all.equal</span>(<span class="fu">m2</span>(x), <span class="fu">var</span>(x) <span class="sc">*</span> <span class="dv">99</span> <span class="sc">/</span> <span class="dv">100</span>))</span></code></pre></div>
<p><strong>A4.</strong> The following function satisfied the specified requirements:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="function-factories.html#cb28-1" aria-hidden="true" tabindex="-1"></a>moment <span class="ot">&lt;-</span> <span class="cf">function</span>(k) {</span>
<span id="cb28-2"><a href="function-factories.html#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">force</span>(k)</span>
<span id="cb28-3"><a href="function-factories.html#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="function-factories.html#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(x) (<span class="fu">sum</span>((x <span class="sc">-</span> <span class="fu">mean</span>(x))<span class="sc">^</span>k)) <span class="sc">/</span> <span class="fu">length</span>(x)</span>
<span id="cb28-5"><a href="function-factories.html#cb28-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Testing it with specified test cases:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="function-factories.html#cb29-1" aria-hidden="true" tabindex="-1"></a>m1 <span class="ot">&lt;-</span> <span class="fu">moment</span>(<span class="dv">1</span>)</span>
<span id="cb29-2"><a href="function-factories.html#cb29-2" aria-hidden="true" tabindex="-1"></a>m2 <span class="ot">&lt;-</span> <span class="fu">moment</span>(<span class="dv">2</span>)</span>
<span id="cb29-3"><a href="function-factories.html#cb29-3" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">100</span>)</span>
<span id="cb29-4"><a href="function-factories.html#cb29-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-5"><a href="function-factories.html#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">all.equal</span>(<span class="fu">m1</span>(x), <span class="dv">0</span>))</span>
<span id="cb29-6"><a href="function-factories.html#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">all.equal</span>(<span class="fu">m2</span>(x), <span class="fu">var</span>(x) <span class="sc">*</span> <span class="dv">99</span> <span class="sc">/</span> <span class="dv">100</span>))</span></code></pre></div>
<hr />
<p><strong>Q5.</strong> What happens if you don’t use a closure? Make predictions, then verify with the code below.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="function-factories.html#cb30-1" aria-hidden="true" tabindex="-1"></a>i <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb30-2"><a href="function-factories.html#cb30-2" aria-hidden="true" tabindex="-1"></a>new_counter2 <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb30-3"><a href="function-factories.html#cb30-3" aria-hidden="true" tabindex="-1"></a>  i <span class="ot">&lt;&lt;-</span> i <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb30-4"><a href="function-factories.html#cb30-4" aria-hidden="true" tabindex="-1"></a>  i</span>
<span id="cb30-5"><a href="function-factories.html#cb30-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>A5.</strong> In case closures are not used, the counts are stored in the global variable, which can be modified by other processes or even deleted.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="function-factories.html#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">new_counter2</span>()</span>
<span id="cb31-2"><a href="function-factories.html#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 1</span></span>
<span id="cb31-3"><a href="function-factories.html#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="function-factories.html#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="fu">new_counter2</span>()</span>
<span id="cb31-5"><a href="function-factories.html#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 2</span></span>
<span id="cb31-6"><a href="function-factories.html#cb31-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7"><a href="function-factories.html#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="fu">new_counter2</span>()</span>
<span id="cb31-8"><a href="function-factories.html#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 3</span></span>
<span id="cb31-9"><a href="function-factories.html#cb31-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-10"><a href="function-factories.html#cb31-10" aria-hidden="true" tabindex="-1"></a>i <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb31-11"><a href="function-factories.html#cb31-11" aria-hidden="true" tabindex="-1"></a><span class="fu">new_counter2</span>()</span>
<span id="cb31-12"><a href="function-factories.html#cb31-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 21</span></span></code></pre></div>
<hr />
<p><strong>Q6.</strong> What happens if you use <code>&lt;-</code> instead of <code>&lt;&lt;-</code>? Make predictions, then verify with the code below.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="function-factories.html#cb32-1" aria-hidden="true" tabindex="-1"></a>new_counter3 <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb32-2"><a href="function-factories.html#cb32-2" aria-hidden="true" tabindex="-1"></a>  i <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb32-3"><a href="function-factories.html#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>() {</span>
<span id="cb32-4"><a href="function-factories.html#cb32-4" aria-hidden="true" tabindex="-1"></a>    i <span class="ot">&lt;-</span> i <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb32-5"><a href="function-factories.html#cb32-5" aria-hidden="true" tabindex="-1"></a>    i</span>
<span id="cb32-6"><a href="function-factories.html#cb32-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb32-7"><a href="function-factories.html#cb32-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>A6.</strong> In this case, the function will always return 1.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="function-factories.html#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">new_counter3</span>()</span>
<span id="cb33-2"><a href="function-factories.html#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; function() {</span></span>
<span id="cb33-3"><a href="function-factories.html#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     i &lt;- i + 1</span></span>
<span id="cb33-4"><a href="function-factories.html#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     i</span></span>
<span id="cb33-5"><a href="function-factories.html#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   }</span></span>
<span id="cb33-6"><a href="function-factories.html#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;environment: 0x13b68ffb0&gt;</span></span>
<span id="cb33-7"><a href="function-factories.html#cb33-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-8"><a href="function-factories.html#cb33-8" aria-hidden="true" tabindex="-1"></a><span class="fu">new_counter3</span>()</span>
<span id="cb33-9"><a href="function-factories.html#cb33-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; function() {</span></span>
<span id="cb33-10"><a href="function-factories.html#cb33-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     i &lt;- i + 1</span></span>
<span id="cb33-11"><a href="function-factories.html#cb33-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     i</span></span>
<span id="cb33-12"><a href="function-factories.html#cb33-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   }</span></span>
<span id="cb33-13"><a href="function-factories.html#cb33-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;bytecode: 0x13b2556e0&gt;</span></span>
<span id="cb33-14"><a href="function-factories.html#cb33-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;environment: 0x13af436c0&gt;</span></span></code></pre></div>
<hr />
</div>
<div id="exercises-10.3.4" class="section level3" number="10.0.2">
<h3><span class="header-section-number">10.0.2</span> Exercises 10.3.4</h3>
<hr />
<p><strong>Q1.</strong> Compare and contrast <code>ggplot2::label_bquote()</code> with <code>scales::number_format()</code>.</p>
<p><strong>A1.</strong> To compare and contrast, let’s first look at the source code for these functions:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="function-factories.html#cb34-1" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span>label_bquote</span>
<span id="cb34-2"><a href="function-factories.html#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; function (rows = NULL, cols = NULL, default) </span></span>
<span id="cb34-3"><a href="function-factories.html#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; {</span></span>
<span id="cb34-4"><a href="function-factories.html#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     cols_quoted &lt;- substitute(cols)</span></span>
<span id="cb34-5"><a href="function-factories.html#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     rows_quoted &lt;- substitute(rows)</span></span>
<span id="cb34-6"><a href="function-factories.html#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     has_warned &lt;- FALSE</span></span>
<span id="cb34-7"><a href="function-factories.html#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     call_env &lt;- env_parent()</span></span>
<span id="cb34-8"><a href="function-factories.html#cb34-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     fun &lt;- function(labels) {</span></span>
<span id="cb34-9"><a href="function-factories.html#cb34-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         quoted &lt;- resolve_labeller(rows_quoted, cols_quoted, </span></span>
<span id="cb34-10"><a href="function-factories.html#cb34-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             labels)</span></span>
<span id="cb34-11"><a href="function-factories.html#cb34-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         if (is.null(quoted)) {</span></span>
<span id="cb34-12"><a href="function-factories.html#cb34-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             return(label_value(labels))</span></span>
<span id="cb34-13"><a href="function-factories.html#cb34-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         }</span></span>
<span id="cb34-14"><a href="function-factories.html#cb34-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         evaluate &lt;- function(...) {</span></span>
<span id="cb34-15"><a href="function-factories.html#cb34-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             params &lt;- list(...)</span></span>
<span id="cb34-16"><a href="function-factories.html#cb34-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             if (&quot;x&quot; %in% find_names(quoted) &amp;&amp; !&quot;x&quot; %in% names(params)) {</span></span>
<span id="cb34-17"><a href="function-factories.html#cb34-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                 if (!has_warned) {</span></span>
<span id="cb34-18"><a href="function-factories.html#cb34-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                   warn(&quot;Referring to `x` is deprecated, use variable name instead&quot;)</span></span>
<span id="cb34-19"><a href="function-factories.html#cb34-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                   has_warned &lt;&lt;- TRUE</span></span>
<span id="cb34-20"><a href="function-factories.html#cb34-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                 }</span></span>
<span id="cb34-21"><a href="function-factories.html#cb34-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                 params$x &lt;- params[[1]]</span></span>
<span id="cb34-22"><a href="function-factories.html#cb34-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             }</span></span>
<span id="cb34-23"><a href="function-factories.html#cb34-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             params &lt;- as_environment(params, call_env)</span></span>
<span id="cb34-24"><a href="function-factories.html#cb34-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             eval(substitute(bquote(expr, params), list(expr = quoted)))</span></span>
<span id="cb34-25"><a href="function-factories.html#cb34-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         }</span></span>
<span id="cb34-26"><a href="function-factories.html#cb34-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         list(do.call(&quot;Map&quot;, c(list(f = evaluate), labels)))</span></span>
<span id="cb34-27"><a href="function-factories.html#cb34-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     }</span></span>
<span id="cb34-28"><a href="function-factories.html#cb34-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     structure(fun, class = &quot;labeller&quot;)</span></span>
<span id="cb34-29"><a href="function-factories.html#cb34-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; }</span></span>
<span id="cb34-30"><a href="function-factories.html#cb34-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;bytecode: 0x13a164eb8&gt;</span></span>
<span id="cb34-31"><a href="function-factories.html#cb34-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;environment: namespace:ggplot2&gt;</span></span>
<span id="cb34-32"><a href="function-factories.html#cb34-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-33"><a href="function-factories.html#cb34-33" aria-hidden="true" tabindex="-1"></a>scales<span class="sc">::</span>number_format</span>
<span id="cb34-34"><a href="function-factories.html#cb34-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; function (accuracy = NULL, scale = 1, prefix = &quot;&quot;, suffix = &quot;&quot;, </span></span>
<span id="cb34-35"><a href="function-factories.html#cb34-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     big.mark = &quot; &quot;, decimal.mark = &quot;.&quot;, style_positive = c(&quot;none&quot;, </span></span>
<span id="cb34-36"><a href="function-factories.html#cb34-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         &quot;plus&quot;), style_negative = c(&quot;hyphen&quot;, &quot;minus&quot;, &quot;parens&quot;), </span></span>
<span id="cb34-37"><a href="function-factories.html#cb34-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     scale_cut = NULL, trim = TRUE, ...) </span></span>
<span id="cb34-38"><a href="function-factories.html#cb34-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; {</span></span>
<span id="cb34-39"><a href="function-factories.html#cb34-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     force_all(accuracy, scale, prefix, suffix, big.mark, decimal.mark, </span></span>
<span id="cb34-40"><a href="function-factories.html#cb34-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         style_positive, style_negative, scale_cut, trim, ...)</span></span>
<span id="cb34-41"><a href="function-factories.html#cb34-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     function(x) {</span></span>
<span id="cb34-42"><a href="function-factories.html#cb34-42" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         number(x, accuracy = accuracy, scale = scale, prefix = prefix, </span></span>
<span id="cb34-43"><a href="function-factories.html#cb34-43" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             suffix = suffix, big.mark = big.mark, decimal.mark = decimal.mark, </span></span>
<span id="cb34-44"><a href="function-factories.html#cb34-44" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             style_positive = style_positive, style_negative = style_negative, </span></span>
<span id="cb34-45"><a href="function-factories.html#cb34-45" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             scale_cut = scale_cut, trim = trim, ...)</span></span>
<span id="cb34-46"><a href="function-factories.html#cb34-46" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     }</span></span>
<span id="cb34-47"><a href="function-factories.html#cb34-47" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; }</span></span>
<span id="cb34-48"><a href="function-factories.html#cb34-48" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;bytecode: 0x11a3163b0&gt;</span></span>
<span id="cb34-49"><a href="function-factories.html#cb34-49" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;environment: namespace:scales&gt;</span></span></code></pre></div>
<p>Both of these functions returns formatting functions used to style the facets labels and other labels to have the desired format.</p>
<p>For example, using plotmath expression in the facet label:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="function-factories.html#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb35-2"><a href="function-factories.html#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="function-factories.html#cb35-3" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(wt, mpg)) <span class="sc">+</span></span>
<span id="cb35-4"><a href="function-factories.html#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span>
<span id="cb35-5"><a href="function-factories.html#cb35-5" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">facet_grid</span>(. <span class="sc">~</span> vs, <span class="at">labeller =</span> <span class="fu">label_bquote</span>(<span class="at">cols =</span> alpha<span class="sc">^</span>.(vs)))</span></code></pre></div>
<p><img src="Function-factories_files/figure-html/unnamed-chunk-17-1.png" width="100%" /></p>
<p>Or to display axes labels in the desired format:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="function-factories.html#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb36-2"><a href="function-factories.html#cb36-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-3"><a href="function-factories.html#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(wt, mpg)) <span class="sc">+</span></span>
<span id="cb36-4"><a href="function-factories.html#cb36-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb36-5"><a href="function-factories.html#cb36-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="fu">number_format</span>(<span class="at">accuracy =</span> <span class="fl">0.01</span>, <span class="at">decimal.mark =</span> <span class="st">&quot;,&quot;</span>))</span></code></pre></div>
<p><img src="Function-factories_files/figure-html/unnamed-chunk-18-1.png" width="100%" /></p>
<p>The <code>ggplot2::label_bquote()</code> adds an additional class to the returned function.</p>
<p>The <code>scales::number_format()</code> function is a simple pass-through method that forces evaluation of all its parameters and passes them on to the underlying <code>scales::number()</code> function.</p>
<hr />
</div>
<div id="exercises-10.4.4" class="section level3" number="10.0.3">
<h3><span class="header-section-number">10.0.3</span> Exercises 10.4.4</h3>
<hr />
<p><strong>Q1.</strong> In <code>boot_model()</code>, why don’t I need to force the evaluation of <code>df</code> or <code>model</code>?</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="function-factories.html#cb37-1" aria-hidden="true" tabindex="-1"></a>boot_model <span class="ot">&lt;-</span> <span class="cf">function</span>(df, formula) {</span>
<span id="cb37-2"><a href="function-factories.html#cb37-2" aria-hidden="true" tabindex="-1"></a>  mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(formula, <span class="at">data =</span> df)</span>
<span id="cb37-3"><a href="function-factories.html#cb37-3" aria-hidden="true" tabindex="-1"></a>  fitted <span class="ot">&lt;-</span> <span class="fu">unname</span>(<span class="fu">fitted</span>(mod))</span>
<span id="cb37-4"><a href="function-factories.html#cb37-4" aria-hidden="true" tabindex="-1"></a>  resid <span class="ot">&lt;-</span> <span class="fu">unname</span>(<span class="fu">resid</span>(mod))</span>
<span id="cb37-5"><a href="function-factories.html#cb37-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(mod)</span>
<span id="cb37-6"><a href="function-factories.html#cb37-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-7"><a href="function-factories.html#cb37-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">env_binding_are_lazy</span>(<span class="fu">current_env</span>()))</span>
<span id="cb37-8"><a href="function-factories.html#cb37-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-9"><a href="function-factories.html#cb37-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>() {</span>
<span id="cb37-10"><a href="function-factories.html#cb37-10" aria-hidden="true" tabindex="-1"></a>    fitted <span class="sc">+</span> <span class="fu">sample</span>(resid)</span>
<span id="cb37-11"><a href="function-factories.html#cb37-11" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb37-12"><a href="function-factories.html#cb37-12" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>We can also confirm that there are no lazy bindings in the function environment:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="function-factories.html#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">boot_model</span>(mtcars, mpg <span class="sc">~</span> wt)</span>
<span id="cb38-2"><a href="function-factories.html#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   resid  fitted      df formula </span></span>
<span id="cb38-3"><a href="function-factories.html#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   FALSE   FALSE   FALSE   FALSE</span></span>
<span id="cb38-4"><a href="function-factories.html#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; function() {</span></span>
<span id="cb38-5"><a href="function-factories.html#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     fitted + sample(resid)</span></span>
<span id="cb38-6"><a href="function-factories.html#cb38-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   }</span></span>
<span id="cb38-7"><a href="function-factories.html#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;environment: 0x11bc4fc48&gt;</span></span></code></pre></div>
<p>Contrast this with the first function we saw in the chapter which <em>did</em> have a lazy binding:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="function-factories.html#cb39-1" aria-hidden="true" tabindex="-1"></a>power1 <span class="ot">&lt;-</span> <span class="cf">function</span>(exp) {</span>
<span id="cb39-2"><a href="function-factories.html#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">env_binding_are_lazy</span>(<span class="fu">current_env</span>()))</span>
<span id="cb39-3"><a href="function-factories.html#cb39-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-4"><a href="function-factories.html#cb39-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(x) {</span>
<span id="cb39-5"><a href="function-factories.html#cb39-5" aria-hidden="true" tabindex="-1"></a>    x<span class="sc">^</span>exp</span>
<span id="cb39-6"><a href="function-factories.html#cb39-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb39-7"><a href="function-factories.html#cb39-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb39-8"><a href="function-factories.html#cb39-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-9"><a href="function-factories.html#cb39-9" aria-hidden="true" tabindex="-1"></a><span class="fu">power1</span>(<span class="dv">2</span>)</span>
<span id="cb39-10"><a href="function-factories.html#cb39-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  exp </span></span>
<span id="cb39-11"><a href="function-factories.html#cb39-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; TRUE</span></span>
<span id="cb39-12"><a href="function-factories.html#cb39-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; function(x) {</span></span>
<span id="cb39-13"><a href="function-factories.html#cb39-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     x^exp</span></span>
<span id="cb39-14"><a href="function-factories.html#cb39-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   }</span></span>
<span id="cb39-15"><a href="function-factories.html#cb39-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;environment: 0x11bfddfc8&gt;</span></span></code></pre></div>
<hr />
<p><strong>Q2.</strong> Why might you formulate the Box-Cox transformation like this?</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="function-factories.html#cb40-1" aria-hidden="true" tabindex="-1"></a>boxcox3 <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb40-2"><a href="function-factories.html#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(lambda) {</span>
<span id="cb40-3"><a href="function-factories.html#cb40-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (lambda <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb40-4"><a href="function-factories.html#cb40-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">log</span>(x)</span>
<span id="cb40-5"><a href="function-factories.html#cb40-5" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb40-6"><a href="function-factories.html#cb40-6" aria-hidden="true" tabindex="-1"></a>      (x<span class="sc">^</span>lambda <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">/</span> lambda</span>
<span id="cb40-7"><a href="function-factories.html#cb40-7" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb40-8"><a href="function-factories.html#cb40-8" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb40-9"><a href="function-factories.html#cb40-9" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>A2.</strong> To see why we formulate this transformation like above by comparing it to the one mentioned in the book:</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="function-factories.html#cb41-1" aria-hidden="true" tabindex="-1"></a>boxcox2 <span class="ot">&lt;-</span> <span class="cf">function</span>(lambda) {</span>
<span id="cb41-2"><a href="function-factories.html#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (lambda <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb41-3"><a href="function-factories.html#cb41-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">function</span>(x) <span class="fu">log</span>(x)</span>
<span id="cb41-4"><a href="function-factories.html#cb41-4" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb41-5"><a href="function-factories.html#cb41-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">function</span>(x) (x<span class="sc">^</span>lambda <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">/</span> lambda</span>
<span id="cb41-6"><a href="function-factories.html#cb41-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb41-7"><a href="function-factories.html#cb41-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Let’s have a look at one example with each:</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="function-factories.html#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">boxcox2</span>(<span class="dv">1</span>)</span>
<span id="cb42-2"><a href="function-factories.html#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; function(x) (x^lambda - 1) / lambda</span></span>
<span id="cb42-3"><a href="function-factories.html#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;environment: 0x13ae5d878&gt;</span></span>
<span id="cb42-4"><a href="function-factories.html#cb42-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-5"><a href="function-factories.html#cb42-5" aria-hidden="true" tabindex="-1"></a><span class="fu">boxcox3</span>(mtcars<span class="sc">$</span>wt)</span>
<span id="cb42-6"><a href="function-factories.html#cb42-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; function(lambda) {</span></span>
<span id="cb42-7"><a href="function-factories.html#cb42-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     if (lambda == 0) {</span></span>
<span id="cb42-8"><a href="function-factories.html#cb42-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       log(x)</span></span>
<span id="cb42-9"><a href="function-factories.html#cb42-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     } else {</span></span>
<span id="cb42-10"><a href="function-factories.html#cb42-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       (x^lambda - 1) / lambda</span></span>
<span id="cb42-11"><a href="function-factories.html#cb42-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     }</span></span>
<span id="cb42-12"><a href="function-factories.html#cb42-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   }</span></span>
<span id="cb42-13"><a href="function-factories.html#cb42-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;environment: 0x13b832f60&gt;</span></span></code></pre></div>
<p>As can be seen, in <code>boxcox2()</code>, we can vary <code>x</code> for the same value of <code>lambda</code>, while in <code>boxcox3()</code>, we can vary <code>lambda</code> for the same vector. This can be handy while exploring different transformations across inputs.</p>
<hr />
<p><strong>Q3.</strong> Why don’t you need to worry that <code>boot_permute()</code> stores a copy of the data inside the function that it generates?</p>
<p><strong>A3.</strong> If we look at the source code generated by the function factory, we notice that the exact data frame (<code>mtcars</code>) is not referenced:</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="function-factories.html#cb43-1" aria-hidden="true" tabindex="-1"></a>boot_permute <span class="ot">&lt;-</span> <span class="cf">function</span>(df, var) {</span>
<span id="cb43-2"><a href="function-factories.html#cb43-2" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(df)</span>
<span id="cb43-3"><a href="function-factories.html#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">force</span>(var)</span>
<span id="cb43-4"><a href="function-factories.html#cb43-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-5"><a href="function-factories.html#cb43-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>() {</span>
<span id="cb43-6"><a href="function-factories.html#cb43-6" aria-hidden="true" tabindex="-1"></a>    col <span class="ot">&lt;-</span> df[[var]]</span>
<span id="cb43-7"><a href="function-factories.html#cb43-7" aria-hidden="true" tabindex="-1"></a>    col[<span class="fu">sample</span>(n, <span class="at">replace =</span> <span class="cn">TRUE</span>)]</span>
<span id="cb43-8"><a href="function-factories.html#cb43-8" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb43-9"><a href="function-factories.html#cb43-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb43-10"><a href="function-factories.html#cb43-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-11"><a href="function-factories.html#cb43-11" aria-hidden="true" tabindex="-1"></a><span class="fu">boot_permute</span>(mtcars, <span class="st">&quot;mpg&quot;</span>)</span>
<span id="cb43-12"><a href="function-factories.html#cb43-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; function() {</span></span>
<span id="cb43-13"><a href="function-factories.html#cb43-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     col &lt;- df[[var]]</span></span>
<span id="cb43-14"><a href="function-factories.html#cb43-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     col[sample(n, replace = TRUE)]</span></span>
<span id="cb43-15"><a href="function-factories.html#cb43-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   }</span></span>
<span id="cb43-16"><a href="function-factories.html#cb43-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;environment: 0x149ea0f48&gt;</span></span></code></pre></div>
<p>This is why we don’t need to worry about a copy being made because the <code>df</code> in the function environment points to the memory address of the data frame. We can confirm this by comparing their memory addresses:</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="function-factories.html#cb44-1" aria-hidden="true" tabindex="-1"></a>boot_permute_env <span class="ot">&lt;-</span> rlang<span class="sc">::</span><span class="fu">fn_env</span>(<span class="fu">boot_permute</span>(mtcars, <span class="st">&quot;mpg&quot;</span>))</span>
<span id="cb44-2"><a href="function-factories.html#cb44-2" aria-hidden="true" tabindex="-1"></a>rlang<span class="sc">::</span><span class="fu">env_print</span>(boot_permute_env)</span>
<span id="cb44-3"><a href="function-factories.html#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;environment: 0x14ac71c40&gt;</span></span>
<span id="cb44-4"><a href="function-factories.html#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Parent: &lt;environment: global&gt;</span></span>
<span id="cb44-5"><a href="function-factories.html#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Bindings:</span></span>
<span id="cb44-6"><a href="function-factories.html#cb44-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • n: &lt;int&gt;</span></span>
<span id="cb44-7"><a href="function-factories.html#cb44-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • df: &lt;df[,11]&gt;</span></span>
<span id="cb44-8"><a href="function-factories.html#cb44-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; • var: &lt;chr&gt;</span></span>
<span id="cb44-9"><a href="function-factories.html#cb44-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-10"><a href="function-factories.html#cb44-10" aria-hidden="true" tabindex="-1"></a><span class="fu">identical</span>(</span>
<span id="cb44-11"><a href="function-factories.html#cb44-11" aria-hidden="true" tabindex="-1"></a>  lobstr<span class="sc">::</span><span class="fu">obj_addr</span>(boot_permute_env<span class="sc">$</span>df),</span>
<span id="cb44-12"><a href="function-factories.html#cb44-12" aria-hidden="true" tabindex="-1"></a>  lobstr<span class="sc">::</span><span class="fu">obj_addr</span>(mtcars)</span>
<span id="cb44-13"><a href="function-factories.html#cb44-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb44-14"><a href="function-factories.html#cb44-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>We can also check that the values of these bindings are the same as what we entered into the function factory:</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="function-factories.html#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">identical</span>(boot_permute_env<span class="sc">$</span>df, mtcars)</span>
<span id="cb45-2"><a href="function-factories.html#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span>
<span id="cb45-3"><a href="function-factories.html#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="fu">identical</span>(boot_permute_env<span class="sc">$</span>var, <span class="st">&quot;mpg&quot;</span>)</span>
<span id="cb45-4"><a href="function-factories.html#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<hr />
<p><strong>Q4.</strong> How much time does <code>ll_poisson2()</code> save compared to <code>ll_poisson1()</code>? Use <code>bench::mark()</code> to see how much faster the optimisation occurs. How does changing the length of <code>x</code> change the results?</p>
<p><strong>A4.</strong> Let’s first compare the performance of these functions with the example in the book:</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="function-factories.html#cb46-1" aria-hidden="true" tabindex="-1"></a>ll_poisson1 <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb46-2"><a href="function-factories.html#cb46-2" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">length</span>(x)</span>
<span id="cb46-3"><a href="function-factories.html#cb46-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-4"><a href="function-factories.html#cb46-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(lambda) {</span>
<span id="cb46-5"><a href="function-factories.html#cb46-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">log</span>(lambda) <span class="sc">*</span> <span class="fu">sum</span>(x) <span class="sc">-</span> n <span class="sc">*</span> lambda <span class="sc">-</span> <span class="fu">sum</span>(<span class="fu">lfactorial</span>(x))</span>
<span id="cb46-6"><a href="function-factories.html#cb46-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb46-7"><a href="function-factories.html#cb46-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb46-8"><a href="function-factories.html#cb46-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-9"><a href="function-factories.html#cb46-9" aria-hidden="true" tabindex="-1"></a>ll_poisson2 <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb46-10"><a href="function-factories.html#cb46-10" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">length</span>(x)</span>
<span id="cb46-11"><a href="function-factories.html#cb46-11" aria-hidden="true" tabindex="-1"></a>  sum_x <span class="ot">&lt;-</span> <span class="fu">sum</span>(x)</span>
<span id="cb46-12"><a href="function-factories.html#cb46-12" aria-hidden="true" tabindex="-1"></a>  c <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">lfactorial</span>(x))</span>
<span id="cb46-13"><a href="function-factories.html#cb46-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-14"><a href="function-factories.html#cb46-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(lambda) {</span>
<span id="cb46-15"><a href="function-factories.html#cb46-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">log</span>(lambda) <span class="sc">*</span> sum_x <span class="sc">-</span> n <span class="sc">*</span> lambda <span class="sc">-</span> c</span>
<span id="cb46-16"><a href="function-factories.html#cb46-16" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb46-17"><a href="function-factories.html#cb46-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb46-18"><a href="function-factories.html#cb46-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-19"><a href="function-factories.html#cb46-19" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">41</span>, <span class="dv">30</span>, <span class="dv">31</span>, <span class="dv">38</span>, <span class="dv">29</span>, <span class="dv">24</span>, <span class="dv">30</span>, <span class="dv">29</span>, <span class="dv">31</span>, <span class="dv">38</span>)</span>
<span id="cb46-20"><a href="function-factories.html#cb46-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-21"><a href="function-factories.html#cb46-21" aria-hidden="true" tabindex="-1"></a>bench<span class="sc">::</span><span class="fu">mark</span>(</span>
<span id="cb46-22"><a href="function-factories.html#cb46-22" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;LL1&quot;</span> <span class="ot">=</span> <span class="fu">optimise</span>(<span class="fu">ll_poisson1</span>(x1), <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>), <span class="at">maximum =</span> <span class="cn">TRUE</span>),</span>
<span id="cb46-23"><a href="function-factories.html#cb46-23" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;LL2&quot;</span> <span class="ot">=</span> <span class="fu">optimise</span>(<span class="fu">ll_poisson2</span>(x1), <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>), <span class="at">maximum =</span> <span class="cn">TRUE</span>)</span>
<span id="cb46-24"><a href="function-factories.html#cb46-24" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb46-25"><a href="function-factories.html#cb46-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 2 × 6</span></span>
<span id="cb46-26"><a href="function-factories.html#cb46-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   expression      min   median `itr/sec` mem_alloc `gc/sec`</span></span>
<span id="cb46-27"><a href="function-factories.html#cb46-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;bch:expr&gt; &lt;bch:tm&gt; &lt;bch:tm&gt;     &lt;dbl&gt; &lt;bch:byt&gt;    &lt;dbl&gt;</span></span>
<span id="cb46-28"><a href="function-factories.html#cb46-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 LL1            13µs  15.25µs    57104.    12.8KB     28.6</span></span>
<span id="cb46-29"><a href="function-factories.html#cb46-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 LL2          6.93µs   7.46µs   127639.        0B     25.5</span></span></code></pre></div>
<p>As can be seen, the second version is much faster than the first version.</p>
<p>We can also vary the length of the vector and confirm that across a wide range of vector lengths, this performance advantage is observed.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="function-factories.html#cb47-1" aria-hidden="true" tabindex="-1"></a>generate_ll_benches <span class="ot">&lt;-</span> <span class="cf">function</span>(n) {</span>
<span id="cb47-2"><a href="function-factories.html#cb47-2" aria-hidden="true" tabindex="-1"></a>  x_vec <span class="ot">&lt;-</span> <span class="fu">sample.int</span>(n, n)</span>
<span id="cb47-3"><a href="function-factories.html#cb47-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-4"><a href="function-factories.html#cb47-4" aria-hidden="true" tabindex="-1"></a>  bench<span class="sc">::</span><span class="fu">mark</span>(</span>
<span id="cb47-5"><a href="function-factories.html#cb47-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;LL1&quot;</span> <span class="ot">=</span> <span class="fu">optimise</span>(<span class="fu">ll_poisson1</span>(x_vec), <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>), <span class="at">maximum =</span> <span class="cn">TRUE</span>),</span>
<span id="cb47-6"><a href="function-factories.html#cb47-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;LL2&quot;</span> <span class="ot">=</span> <span class="fu">optimise</span>(<span class="fu">ll_poisson2</span>(x_vec), <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>), <span class="at">maximum =</span> <span class="cn">TRUE</span>)</span>
<span id="cb47-7"><a href="function-factories.html#cb47-7" aria-hidden="true" tabindex="-1"></a>  )[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>] <span class="sc">%&gt;%</span></span>
<span id="cb47-8"><a href="function-factories.html#cb47-8" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">length =</span> n, <span class="at">.before =</span> expression)</span>
<span id="cb47-9"><a href="function-factories.html#cb47-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb47-10"><a href="function-factories.html#cb47-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-11"><a href="function-factories.html#cb47-11" aria-hidden="true" tabindex="-1"></a>(df_bench <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_dfr</span>(</span>
<span id="cb47-12"><a href="function-factories.html#cb47-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">.x =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">50</span>, <span class="dv">100</span>, <span class="dv">1000</span>),</span>
<span id="cb47-13"><a href="function-factories.html#cb47-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">.f =</span> <span class="sc">~</span> <span class="fu">generate_ll_benches</span>(<span class="at">n =</span> .x)</span>
<span id="cb47-14"><a href="function-factories.html#cb47-14" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb47-15"><a href="function-factories.html#cb47-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 10 × 5</span></span>
<span id="cb47-16"><a href="function-factories.html#cb47-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    length expression      min   median `itr/sec`</span></span>
<span id="cb47-17"><a href="function-factories.html#cb47-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     &lt;dbl&gt; &lt;bch:expr&gt; &lt;bch:tm&gt; &lt;bch:tm&gt;     &lt;dbl&gt;</span></span>
<span id="cb47-18"><a href="function-factories.html#cb47-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1     10 LL1         20.75µs  22.14µs    43657.</span></span>
<span id="cb47-19"><a href="function-factories.html#cb47-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2     10 LL2          8.49µs   9.06µs   108535.</span></span>
<span id="cb47-20"><a href="function-factories.html#cb47-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3     20 LL1         22.63µs   23.7µs    41625.</span></span>
<span id="cb47-21"><a href="function-factories.html#cb47-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4     20 LL2          8.28µs   8.81µs   111676.</span></span>
<span id="cb47-22"><a href="function-factories.html#cb47-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5     50 LL1         26.81µs  27.88µs    35382.</span></span>
<span id="cb47-23"><a href="function-factories.html#cb47-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6     50 LL2          8.16µs   8.65µs   114116.</span></span>
<span id="cb47-24"><a href="function-factories.html#cb47-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7    100 LL1         37.39µs   39.2µs    25043.</span></span>
<span id="cb47-25"><a href="function-factories.html#cb47-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8    100 LL2          8.98µs   9.51µs   103234.</span></span>
<span id="cb47-26"><a href="function-factories.html#cb47-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9   1000 LL1        518.32µs 536.36µs     1851.</span></span>
<span id="cb47-27"><a href="function-factories.html#cb47-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10   1000 LL2         29.93µs  31.04µs    31800.</span></span>
<span id="cb47-28"><a href="function-factories.html#cb47-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-29"><a href="function-factories.html#cb47-29" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb47-30"><a href="function-factories.html#cb47-30" aria-hidden="true" tabindex="-1"></a>  df_bench,</span>
<span id="cb47-31"><a href="function-factories.html#cb47-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(</span>
<span id="cb47-32"><a href="function-factories.html#cb47-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">as.numeric</span>(length),</span>
<span id="cb47-33"><a href="function-factories.html#cb47-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> median,</span>
<span id="cb47-34"><a href="function-factories.html#cb47-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">group =</span> <span class="fu">as.character</span>(expression),</span>
<span id="cb47-35"><a href="function-factories.html#cb47-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="fu">as.character</span>(expression)</span>
<span id="cb47-36"><a href="function-factories.html#cb47-36" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb47-37"><a href="function-factories.html#cb47-37" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb47-38"><a href="function-factories.html#cb47-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb47-39"><a href="function-factories.html#cb47-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb47-40"><a href="function-factories.html#cb47-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb47-41"><a href="function-factories.html#cb47-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Vector length&quot;</span>,</span>
<span id="cb47-42"><a href="function-factories.html#cb47-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Median Execution Time&quot;</span>,</span>
<span id="cb47-43"><a href="function-factories.html#cb47-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">colour =</span> <span class="st">&quot;Function used&quot;</span></span>
<span id="cb47-44"><a href="function-factories.html#cb47-44" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="Function-factories_files/figure-html/unnamed-chunk-29-1.png" width="100%" /></p>
<hr />
</div>
<div id="exercises-10.5.1" class="section level3" number="10.0.4">
<h3><span class="header-section-number">10.0.4</span> Exercises 10.5.1</h3>
<p><strong>Q1.</strong> Which of the following commands is equivalent to <code>with(x, f(z))</code>?</p>
<pre><code>(a) `x$f(x$z)`.
(b) `f(x$z)`.
(c) `x$f(z)`.
(d) `f(z)`.
(e) It depends.</code></pre>
<hr />
<p><strong>Q2.</strong> Compare and contrast the effects of <code>env_bind()</code> vs. <code>attach()</code> for the following code.</p>
<p><strong>A2.</strong></p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="function-factories.html#cb49-1" aria-hidden="true" tabindex="-1"></a>funs <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb49-2"><a href="function-factories.html#cb49-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">mean =</span> <span class="cf">function</span>(x) <span class="fu">mean</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb49-3"><a href="function-factories.html#cb49-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">sum =</span> <span class="cf">function</span>(x) <span class="fu">sum</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb49-4"><a href="function-factories.html#cb49-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb49-5"><a href="function-factories.html#cb49-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-6"><a href="function-factories.html#cb49-6" aria-hidden="true" tabindex="-1"></a><span class="fu">attach</span>(funs)</span>
<span id="cb49-7"><a href="function-factories.html#cb49-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; The following objects are masked from package:base:</span></span>
<span id="cb49-8"><a href="function-factories.html#cb49-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb49-9"><a href="function-factories.html#cb49-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     mean, sum</span></span>
<span id="cb49-10"><a href="function-factories.html#cb49-10" aria-hidden="true" tabindex="-1"></a>mean <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">stop</span>(<span class="st">&quot;Hi!&quot;</span>)</span>
<span id="cb49-11"><a href="function-factories.html#cb49-11" aria-hidden="true" tabindex="-1"></a><span class="fu">detach</span>(funs)</span>
<span id="cb49-12"><a href="function-factories.html#cb49-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-13"><a href="function-factories.html#cb49-13" aria-hidden="true" tabindex="-1"></a><span class="fu">env_bind</span>(<span class="fu">globalenv</span>(), <span class="sc">!!!</span>funs)</span>
<span id="cb49-14"><a href="function-factories.html#cb49-14" aria-hidden="true" tabindex="-1"></a>mean <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">stop</span>(<span class="st">&quot;Hi!&quot;</span>)</span>
<span id="cb49-15"><a href="function-factories.html#cb49-15" aria-hidden="true" tabindex="-1"></a><span class="fu">env_unbind</span>(<span class="fu">globalenv</span>(), <span class="fu">names</span>(funs))</span></code></pre></div>
<hr />

</div>
</div>
  </main>

  <div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page">
      <h2>On this page</h2>
      <div id="book-on-this-page"></div>

      <div class="book-extra">
        <ul class="list-unstyled">
          <li><a id="book-source" href="#">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="#">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
      </div>
    </nav>
  </div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5">
  <div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Advanced R Exercises</strong>" was written by <a class="text-light" href="https://sites.google.com/site/indrajeetspatilmorality/">Indrajeet Patil</a>. It was last built on 2022-07-26.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>


</body>

</html>
