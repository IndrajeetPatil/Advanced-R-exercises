<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>Chapter 11 Function operators | Advanced R Exercises</title>

    <meta name="author" content="Indrajeet Patil" />
  
   <meta name="description" content="My solutions to exercises in Hadley Wickham’s Advanced R (2nd edition) book." />
   <meta name="generator" content="placeholder" />
  <meta property="og:title" content="Chapter 11 Function operators | Advanced R Exercises" />
  <meta property="og:type" content="book" />
  
  <meta property="og:image" content="/cover.png" />
  <meta property="og:description" content="My solutions to exercises in Hadley Wickham’s Advanced R (2nd edition) book." />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 11 Function operators | Advanced R Exercises" />
  
  <meta name="twitter:description" content="My solutions to exercises in Hadley Wickham’s Advanced R (2nd edition) book." />
  <meta name="twitter:image" content="/cover.png" />
  <!-- JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script>
  <script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script>
    <script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet" />
    <script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script>
    <script src="libs/bs3compat-0.4.0/transition.js"></script>
    <script src="libs/bs3compat-0.4.0/tabs.js"></script>
    <script src="libs/bs3compat-0.4.0/bs3compat.js"></script>
    <link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet" />
    <script src="libs/bs4_book-1.0.0/bs4_book.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script>

  <!-- CSS -->
  <style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
      <link rel="stylesheet" href="bs4_style.css" />
  
</head>

<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book">
    <a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Advanced R Exercises</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
      </form>

      <nav aria-label="Table of contents">
        <h2>Table of contents</h2>
        <div id="book-toc"></div>

        <div class="book-extra">
          <p><a id="book-repo" href="#">View book source <i class="fab fa-github"></i></a></li></p>
        </div>
      </nav>
    </div>
  </header>

  <main class="col-sm-12 col-md-9 col-lg-7" id="content">
<div id="function-operators" class="section level1" number="11">
<h1><span class="header-section-number">Chapter 11</span> Function operators</h1>
<p>Attaching the needed libraries:</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="function-operators.html#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr, <span class="at">warn.conflicts =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<div id="exercises-11.2.3" class="section level3" number="11.0.1">
<h3><span class="header-section-number">11.0.1</span> Exercises 11.2.3</h3>
<hr />
<p><strong>Q1.</strong> Base R provides a function operator in the form of <code>Vectorize()</code>. What does it do? When might you use it?</p>
<p><strong>A1.</strong> <code>Vectorize()</code> function creates a function that vectorizes the action of the provided function over specified arguments. We will see its utility by solving a problem that otherwise couldn’t be solved.</p>
<p>The problem is to build a hybrid between the following functions:</p>
<ul>
<li><code>%in%</code> (which doesn’t provide any way to provide tolerance when comparing numeric values),</li>
<li><code>dplyr::near()</code> (which is vectorized element-wise and thus expects two vectors of equal length)</li>
</ul>
<p>in order to find indices of matching numeric values for the given threshold.</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="function-operators.html#cb51-1" aria-hidden="true" tabindex="-1"></a>which_near <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y, tolerance) {</span>
<span id="cb51-2"><a href="function-operators.html#cb51-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Vectorize `dplyr::near()` function only over the `y` argument.</span></span>
<span id="cb51-3"><a href="function-operators.html#cb51-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Note that that `Vectorize()` is a function operator and will return a function.</span></span>
<span id="cb51-4"><a href="function-operators.html#cb51-4" aria-hidden="true" tabindex="-1"></a>  customNear <span class="ot">&lt;-</span> <span class="fu">Vectorize</span>(dplyr<span class="sc">::</span>near, <span class="at">vectorize.args =</span> <span class="fu">c</span>(<span class="st">&quot;y&quot;</span>), <span class="at">SIMPLIFY =</span> <span class="cn">FALSE</span>)</span>
<span id="cb51-5"><a href="function-operators.html#cb51-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-6"><a href="function-operators.html#cb51-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Apply the vectorized function to the two vectors and then check where the</span></span>
<span id="cb51-7"><a href="function-operators.html#cb51-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># comparisons are equal (i.e. `TRUE`) using `which()`.</span></span>
<span id="cb51-8"><a href="function-operators.html#cb51-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">#</span></span>
<span id="cb51-9"><a href="function-operators.html#cb51-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Use `compact()` to remove empty elements from the resulting list.</span></span>
<span id="cb51-10"><a href="function-operators.html#cb51-10" aria-hidden="true" tabindex="-1"></a>  index_list <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">compact</span>(purrr<span class="sc">::</span><span class="fu">map</span>(<span class="fu">customNear</span>(x, y, <span class="at">tol =</span> tolerance), which))</span>
<span id="cb51-11"><a href="function-operators.html#cb51-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-12"><a href="function-operators.html#cb51-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># If there are any matches, return the indices as an atomic vector of integers.</span></span>
<span id="cb51-13"><a href="function-operators.html#cb51-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(index_list) <span class="sc">&gt;</span> 0L) {</span>
<span id="cb51-14"><a href="function-operators.html#cb51-14" aria-hidden="true" tabindex="-1"></a>    index_vector <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">simplify</span>(index_list, <span class="st">&quot;integer&quot;</span>)</span>
<span id="cb51-15"><a href="function-operators.html#cb51-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(index_vector)</span>
<span id="cb51-16"><a href="function-operators.html#cb51-16" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb51-17"><a href="function-operators.html#cb51-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-18"><a href="function-operators.html#cb51-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># If there are no matches</span></span>
<span id="cb51-19"><a href="function-operators.html#cb51-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">integer</span>(0L))</span>
<span id="cb51-20"><a href="function-operators.html#cb51-20" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Let’s use it:</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="function-operators.html#cb52-1" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">2.1</span>, <span class="fl">3.3</span>, <span class="fl">8.45</span>, <span class="dv">8</span>, <span class="dv">6</span>)</span>
<span id="cb52-2"><a href="function-operators.html#cb52-2" aria-hidden="true" tabindex="-1"></a>x2 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">6</span>, <span class="fl">8.40</span>, <span class="dv">3</span>)</span>
<span id="cb52-3"><a href="function-operators.html#cb52-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-4"><a href="function-operators.html#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="fu">which</span>(x1 <span class="sc">%in%</span> x2)</span>
<span id="cb52-5"><a href="function-operators.html#cb52-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 5</span></span>
<span id="cb52-6"><a href="function-operators.html#cb52-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-7"><a href="function-operators.html#cb52-7" aria-hidden="true" tabindex="-1"></a><span class="fu">which</span>(dplyr<span class="sc">::</span><span class="fu">near</span>(x1, x2, <span class="at">tol =</span> <span class="fl">0.1</span>))</span>
<span id="cb52-8"><a href="function-operators.html#cb52-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in x - y: longer object length is not a multiple of</span></span>
<span id="cb52-9"><a href="function-operators.html#cb52-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; shorter object length</span></span>
<span id="cb52-10"><a href="function-operators.html#cb52-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; integer(0)</span></span>
<span id="cb52-11"><a href="function-operators.html#cb52-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-12"><a href="function-operators.html#cb52-12" aria-hidden="true" tabindex="-1"></a><span class="fu">which_near</span>(x1, x2, <span class="at">tolerance =</span> <span class="fl">0.1</span>)</span>
<span id="cb52-13"><a href="function-operators.html#cb52-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 5 3</span></span></code></pre></div>
<p>We solved a complex task here using the <code>Vectorize()</code> function!</p>
<hr />
<p><strong>Q2.</strong> Read the source code for <code>possibly()</code>. How does it work?</p>
<p><strong>A2.</strong> Let’s have a look at the source code for this function:</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="function-operators.html#cb53-1" aria-hidden="true" tabindex="-1"></a>possibly</span>
<span id="cb53-2"><a href="function-operators.html#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; function (.f, otherwise, quiet = TRUE) </span></span>
<span id="cb53-3"><a href="function-operators.html#cb53-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; {</span></span>
<span id="cb53-4"><a href="function-operators.html#cb53-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     .f &lt;- as_mapper(.f)</span></span>
<span id="cb53-5"><a href="function-operators.html#cb53-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     force(otherwise)</span></span>
<span id="cb53-6"><a href="function-operators.html#cb53-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     function(...) {</span></span>
<span id="cb53-7"><a href="function-operators.html#cb53-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         tryCatch(.f(...), error = function(e) {</span></span>
<span id="cb53-8"><a href="function-operators.html#cb53-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             if (!quiet) </span></span>
<span id="cb53-9"><a href="function-operators.html#cb53-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                 message(&quot;Error: &quot;, e$message)</span></span>
<span id="cb53-10"><a href="function-operators.html#cb53-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             otherwise</span></span>
<span id="cb53-11"><a href="function-operators.html#cb53-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         }, interrupt = function(e) {</span></span>
<span id="cb53-12"><a href="function-operators.html#cb53-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             stop(&quot;Terminated by user&quot;, call. = FALSE)</span></span>
<span id="cb53-13"><a href="function-operators.html#cb53-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         })</span></span>
<span id="cb53-14"><a href="function-operators.html#cb53-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     }</span></span>
<span id="cb53-15"><a href="function-operators.html#cb53-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; }</span></span>
<span id="cb53-16"><a href="function-operators.html#cb53-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;bytecode: 0x10d571a18&gt;</span></span>
<span id="cb53-17"><a href="function-operators.html#cb53-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;environment: namespace:purrr&gt;</span></span></code></pre></div>
<p>Looking at this code, we can see that <code>possibly()</code>:</p>
<ul>
<li>uses <code>tryCatch()</code> for error handling</li>
<li>has a parameter <code>otherwise</code> to specify default value in case an error occurs</li>
<li>has a parameter <code>quiet</code> to suppress error message (if needed)</li>
</ul>
<hr />
<p><strong>Q3.</strong> Read the source code for <code>safely()</code>. How does it work?</p>
<p><strong>A3.</strong> Let’s have a look at the source code for this function:</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="function-operators.html#cb54-1" aria-hidden="true" tabindex="-1"></a>safely</span>
<span id="cb54-2"><a href="function-operators.html#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; function (.f, otherwise = NULL, quiet = TRUE) </span></span>
<span id="cb54-3"><a href="function-operators.html#cb54-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; {</span></span>
<span id="cb54-4"><a href="function-operators.html#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     .f &lt;- as_mapper(.f)</span></span>
<span id="cb54-5"><a href="function-operators.html#cb54-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     function(...) capture_error(.f(...), otherwise, quiet)</span></span>
<span id="cb54-6"><a href="function-operators.html#cb54-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; }</span></span>
<span id="cb54-7"><a href="function-operators.html#cb54-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;bytecode: 0x10d70da18&gt;</span></span>
<span id="cb54-8"><a href="function-operators.html#cb54-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;environment: namespace:purrr&gt;</span></span>
<span id="cb54-9"><a href="function-operators.html#cb54-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-10"><a href="function-operators.html#cb54-10" aria-hidden="true" tabindex="-1"></a>purrr<span class="sc">:::</span>capture_error</span>
<span id="cb54-11"><a href="function-operators.html#cb54-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; function (code, otherwise = NULL, quiet = TRUE) </span></span>
<span id="cb54-12"><a href="function-operators.html#cb54-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; {</span></span>
<span id="cb54-13"><a href="function-operators.html#cb54-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     tryCatch(list(result = code, error = NULL), error = function(e) {</span></span>
<span id="cb54-14"><a href="function-operators.html#cb54-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         if (!quiet) </span></span>
<span id="cb54-15"><a href="function-operators.html#cb54-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             message(&quot;Error: &quot;, e$message)</span></span>
<span id="cb54-16"><a href="function-operators.html#cb54-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         list(result = otherwise, error = e)</span></span>
<span id="cb54-17"><a href="function-operators.html#cb54-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     }, interrupt = function(e) {</span></span>
<span id="cb54-18"><a href="function-operators.html#cb54-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         stop(&quot;Terminated by user&quot;, call. = FALSE)</span></span>
<span id="cb54-19"><a href="function-operators.html#cb54-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     })</span></span>
<span id="cb54-20"><a href="function-operators.html#cb54-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; }</span></span>
<span id="cb54-21"><a href="function-operators.html#cb54-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;bytecode: 0x10d766978&gt;</span></span>
<span id="cb54-22"><a href="function-operators.html#cb54-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;environment: namespace:purrr&gt;</span></span></code></pre></div>
<p>Looking at this code, we can see that <code>safely()</code>:</p>
<ul>
<li>uses a list to save both the results (if the function executes successfully) and the error (if it fails)</li>
<li>uses <code>tryCatch()</code> for error handling</li>
<li>has a parameter <code>otherwise</code> to specify default value in case an error occurs</li>
<li>has a parameter <code>quiet</code> to suppress error message (if needed)</li>
</ul>
<hr />
</div>
<div id="exercises-11.3.1" class="section level3" number="11.0.2">
<h3><span class="header-section-number">11.0.2</span> Exercises 11.3.1</h3>
<hr />
<p><strong>Q1.</strong> Weigh the pros and cons of <code>download.file %&gt;% dot_every(10) %&gt;% delay_by(0.1)</code> versus <code>download.file %&gt;% delay_by(0.1) %&gt;% dot_every(10)</code>.</p>
<p><strong>A1.</strong> Although both of these chains of piped operations produce the same number of dots and would need the same amount of time, there is a subtle difference in how they do this.</p>
<ul>
<li><code>download.file %&gt;% dot_every(10) %&gt;% delay_by(0.1)</code></li>
</ul>
<p>Here, the printing of the dot is also delayed, and the first dot is printed when the 10th URL download starts.</p>
<ul>
<li><code>download.file %&gt;% delay_by(0.1) %&gt;% dot_every(10)</code></li>
</ul>
<p>Here, the first dot is printed after the 9th download is finished, and the 10th download starts after a short delay.</p>
<hr />
<p><strong>Q2.</strong> Should you memoise <code>download.file()</code>? Why or why not?</p>
<p><strong>A2.</strong> Since <code>download.file()</code> is meant to download files from the Internet, memoising it is not recommended for the following reasons:</p>
<ul>
<li><p>Memoization is helpful when giving the same input the function returns the same output. This is not necessary the case for webpages since they constantly change. This means that you may continue to “download” an outdated version of the webpage.</p></li>
<li><p>Memoization works by caching results, which can take up a significant amount of memory.</p></li>
</ul>
<hr />
<p><strong>Q3.</strong> Create a function operator that reports whenever a file is created or deleted in the working directory, using <code>dir()</code> and <code>setdiff()</code>. What other global function effects might you want to track?</p>
<p><strong>A3.</strong></p>
<hr />
<p><strong>Q4.</strong> Write a function operator that logs a timestamp and message to a file every time a function is run.</p>
<p><strong>A4.</strong> The following function operator logs a timestamp and message to a file every time a function is run:</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="function-operators.html#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># helper function to write to a file connection</span></span>
<span id="cb55-2"><a href="function-operators.html#cb55-2" aria-hidden="true" tabindex="-1"></a>write_line <span class="ot">&lt;-</span> <span class="cf">function</span>(filepath, ...) {</span>
<span id="cb55-3"><a href="function-operators.html#cb55-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(..., <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>, <span class="at">file =</span> filepath, <span class="at">append =</span> <span class="cn">TRUE</span>)</span>
<span id="cb55-4"><a href="function-operators.html#cb55-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb55-5"><a href="function-operators.html#cb55-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-6"><a href="function-operators.html#cb55-6" aria-hidden="true" tabindex="-1"></a><span class="co"># function operator</span></span>
<span id="cb55-7"><a href="function-operators.html#cb55-7" aria-hidden="true" tabindex="-1"></a>logger <span class="ot">&lt;-</span> <span class="cf">function</span>(f, filepath) {</span>
<span id="cb55-8"><a href="function-operators.html#cb55-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">force</span>(f)</span>
<span id="cb55-9"><a href="function-operators.html#cb55-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">force</span>(filepath)</span>
<span id="cb55-10"><a href="function-operators.html#cb55-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-11"><a href="function-operators.html#cb55-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write_line</span>(filepath, <span class="st">&quot;Function created at: &quot;</span>, <span class="fu">as.character</span>(<span class="fu">Sys.time</span>()))</span>
<span id="cb55-12"><a href="function-operators.html#cb55-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-13"><a href="function-operators.html#cb55-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(...) {</span>
<span id="cb55-14"><a href="function-operators.html#cb55-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">write_line</span>(filepath, <span class="st">&quot;Function called at:  &quot;</span>, <span class="fu">as.character</span>(<span class="fu">Sys.time</span>()))</span>
<span id="cb55-15"><a href="function-operators.html#cb55-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">f</span>(...)</span>
<span id="cb55-16"><a href="function-operators.html#cb55-16" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb55-17"><a href="function-operators.html#cb55-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb55-18"><a href="function-operators.html#cb55-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-19"><a href="function-operators.html#cb55-19" aria-hidden="true" tabindex="-1"></a><span class="co"># check that the function works as expected with a tempfile</span></span>
<span id="cb55-20"><a href="function-operators.html#cb55-20" aria-hidden="true" tabindex="-1"></a>withr<span class="sc">::</span><span class="fu">with_tempfile</span>(<span class="st">&quot;logfile&quot;</span>, <span class="at">code =</span> {</span>
<span id="cb55-21"><a href="function-operators.html#cb55-21" aria-hidden="true" tabindex="-1"></a>  logged_runif <span class="ot">&lt;-</span> <span class="fu">logger</span>(runif, logfile)</span>
<span id="cb55-22"><a href="function-operators.html#cb55-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-23"><a href="function-operators.html#cb55-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">Sys.sleep</span>(<span class="fu">sample.int</span>(<span class="dv">10</span>, <span class="dv">1</span>))</span>
<span id="cb55-24"><a href="function-operators.html#cb55-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">logged_runif</span>(<span class="dv">1</span>)</span>
<span id="cb55-25"><a href="function-operators.html#cb55-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-26"><a href="function-operators.html#cb55-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">Sys.sleep</span>(<span class="fu">sample.int</span>(<span class="dv">10</span>, <span class="dv">1</span>))</span>
<span id="cb55-27"><a href="function-operators.html#cb55-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">logged_runif</span>(<span class="dv">2</span>)</span>
<span id="cb55-28"><a href="function-operators.html#cb55-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-29"><a href="function-operators.html#cb55-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">Sys.sleep</span>(<span class="fu">sample.int</span>(<span class="dv">10</span>, <span class="dv">1</span>))</span>
<span id="cb55-30"><a href="function-operators.html#cb55-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">logged_runif</span>(<span class="dv">3</span>)</span>
<span id="cb55-31"><a href="function-operators.html#cb55-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-32"><a href="function-operators.html#cb55-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">readLines</span>(logfile), <span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb55-33"><a href="function-operators.html#cb55-33" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb55-34"><a href="function-operators.html#cb55-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Function created at: 2022-07-26 13:19:27</span></span>
<span id="cb55-35"><a href="function-operators.html#cb55-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Function called at:  2022-07-26 13:19:32</span></span>
<span id="cb55-36"><a href="function-operators.html#cb55-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Function called at:  2022-07-26 13:19:37</span></span>
<span id="cb55-37"><a href="function-operators.html#cb55-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Function called at:  2022-07-26 13:19:45</span></span></code></pre></div>
<hr />
<p><strong>Q5.</strong> Modify <code>delay_by()</code> so that instead of delaying by a fixed amount of time, it ensures that a certain amount of time has elapsed since the function was last called. That is, if you called <code>g &lt;- delay_by(1, f); g(); Sys.sleep(2); g()</code> there shouldn’t be an extra delay.</p>
<p><strong>A5.</strong></p>
<hr />

</div>
</div>
  </main>

  <div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page">
      <h2>On this page</h2>
      <div id="book-on-this-page"></div>

      <div class="book-extra">
        <ul class="list-unstyled">
          <li><a id="book-source" href="#">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="#">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
      </div>
    </nav>
  </div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5">
  <div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Advanced R Exercises</strong>" was written by <a class="text-light" href="https://sites.google.com/site/indrajeetspatilmorality/">Indrajeet Patil</a>. It was last built on 2022-07-26.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>


</body>

</html>
