<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 23 Measuring performance | Advanced R Exercises</title>
<meta name="author" content="Indrajeet Patil">
<meta name="description" content="Attaching the needed libraries: library(profvis, warn.conflicts = FALSE) library(dplyr, warn.conflicts = FALSE)  23.1 Profiling (Exercises 23.2.4) Q1. Profile the following function with torture =...">
<meta name="generator" content="bookdown 0.30 with bs4_book()">
<meta property="og:title" content="Chapter 23 Measuring performance | Advanced R Exercises">
<meta property="og:type" content="book">
<meta property="og:url" content="https://bookdown.org/IndrajeetPatil/Advanced-R-exercises/measuring-performance.html">
<meta property="og:image" content="https://bookdown.org/IndrajeetPatil/Advanced-R-exercises/cover.png">
<meta property="og:description" content="Attaching the needed libraries: library(profvis, warn.conflicts = FALSE) library(dplyr, warn.conflicts = FALSE)  23.1 Profiling (Exercises 23.2.4) Q1. Profile the following function with torture =...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 23 Measuring performance | Advanced R Exercises">
<meta name="twitter:description" content="Attaching the needed libraries: library(profvis, warn.conflicts = FALSE) library(dplyr, warn.conflicts = FALSE)  23.1 Profiling (Exercises 23.2.4) Q1. Profile the following function with torture =...">
<meta name="twitter:image" content="https://bookdown.org/IndrajeetPatil/Advanced-R-exercises/cover.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><link href="libs/Roboto-0.4.2/font.css" rel="stylesheet">
<link href="libs/JetBrains_Mono-0.4.2/font.css" rel="stylesheet">
<link href="libs/Roboto_Slab-0.4.2/font.css" rel="stylesheet">
<script src="libs/bs3compat-0.4.1/transition.js"></script><script src="libs/bs3compat-0.4.1/tabs.js"></script><script src="libs/bs3compat-0.4.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="bs4_style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Advanced R Exercises</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">About</a></li>
<li><a class="" href="introduction.html"><span class="header-section-number">1</span> Introduction</a></li>
<li><a class="" href="names-and-values.html"><span class="header-section-number">2</span> Names and values</a></li>
<li><a class="" href="vectors.html"><span class="header-section-number">3</span> Vectors</a></li>
<li><a class="" href="subsetting.html"><span class="header-section-number">4</span> Subsetting</a></li>
<li><a class="" href="control-flow.html"><span class="header-section-number">5</span> Control flow</a></li>
<li><a class="" href="functions.html"><span class="header-section-number">6</span> Functions</a></li>
<li><a class="" href="environments.html"><span class="header-section-number">7</span> Environments</a></li>
<li><a class="" href="conditions.html"><span class="header-section-number">8</span> Conditions</a></li>
<li><a class="" href="functionals.html"><span class="header-section-number">9</span> Functionals</a></li>
<li><a class="" href="function-factories.html"><span class="header-section-number">10</span> Function factories</a></li>
<li><a class="" href="function-operators.html"><span class="header-section-number">11</span> Function operators</a></li>
<li><a class="" href="base-types.html"><span class="header-section-number">12</span> Base Types</a></li>
<li><a class="" href="s3.html"><span class="header-section-number">13</span> S3</a></li>
<li><a class="" href="r6.html"><span class="header-section-number">14</span> R6</a></li>
<li><a class="" href="s4.html"><span class="header-section-number">15</span> S4</a></li>
<li><a class="" href="trade-offs.html"><span class="header-section-number">16</span> Trade-offs</a></li>
<li><a class="" href="big-picture.html"><span class="header-section-number">17</span> Big Picture</a></li>
<li><a class="" href="expressions.html"><span class="header-section-number">18</span> Expressions</a></li>
<li><a class="" href="quasiquotation.html"><span class="header-section-number">19</span> Quasiquotation</a></li>
<li><a class="" href="evaluation.html"><span class="header-section-number">20</span> Evaluation</a></li>
<li><a class="" href="translation.html"><span class="header-section-number">21</span> Translation</a></li>
<li><a class="" href="debugging.html"><span class="header-section-number">22</span> Debugging</a></li>
<li><a class="active" href="measuring-performance.html"><span class="header-section-number">23</span> Measuring performance</a></li>
<li><a class="" href="improving-performance.html"><span class="header-section-number">24</span> Improving performance</a></li>
<li><a class="" href="rewriting-r-code-in-c.html"><span class="header-section-number">25</span> Rewriting R code in C++</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/IndrajeetPatil/Advanced-R-exercises">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="measuring-performance" class="section level1" number="23">
<h1>
<span class="header-section-number">23</span> Measuring performance<a class="anchor" aria-label="anchor" href="#measuring-performance"><i class="fas fa-link"></i></a>
</h1>
<p>Attaching the needed libraries:</p>
<div class="sourceCode" id="cb635"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rstudio.github.io/profvis/">profvis</a></span>, warn.conflicts <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span>, warn.conflicts <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<div id="profiling-exercises-23.2.4" class="section level2" number="23.1">
<h2>
<span class="header-section-number">23.1</span> Profiling (Exercises 23.2.4)<a class="anchor" aria-label="anchor" href="#profiling-exercises-23.2.4"><i class="fas fa-link"></i></a>
</h2>
<hr>
<p><strong>Q1.</strong> Profile the following function with <code>torture = TRUE</code>. What is surprising? Read the source code of <code><a href="https://rdrr.io/r/base/rm.html">rm()</a></code> to figure out what’s going on.</p>
<div class="sourceCode" id="cb636"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span> <span class="op">=</span> <span class="fl">1e5</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">n</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><strong>A1.</strong> Let’s source the functions mentioned in exercises.</p>
<div class="sourceCode" id="cb637"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/source.html">source</a></span><span class="op">(</span><span class="st">"profiling-exercises.R"</span><span class="op">)</span></span></code></pre></div>
<p>First, we try without <code>torture = TRUE</code>: it returns no meaningful results.</p>
<div class="sourceCode" id="cb638"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/profvis/man/profvis.html">profvis</a></span><span class="op">(</span><span class="fu">f</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in parse_rprof(prof_output, expr_source): No parsing data available. Maybe your function was too fast?</span></span></code></pre></div>
<p>As mentioned in the docs, setting <code>torture = TRUE</code></p>
<blockquote>
<p>Triggers garbage collection after every torture memory allocation call.</p>
</blockquote>
<p>This process somehow never seems to finish and crashes the RStudio session when it stops!</p>
<div class="sourceCode" id="cb639"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/profvis/man/profvis.html">profvis</a></span><span class="op">(</span><span class="fu">f</span><span class="op">(</span><span class="op">)</span>, torture <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>The question says that documentation for <code><a href="https://rdrr.io/r/base/rm.html">rm()</a></code> may provide clues:</p>
<div class="sourceCode" id="cb640"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rm</span></span>
<span><span class="co">#&gt; function (..., list = character(), pos = -1, envir = as.environment(pos), </span></span>
<span><span class="co">#&gt;     inherits = FALSE) </span></span>
<span><span class="co">#&gt; {</span></span>
<span><span class="co">#&gt;     dots &lt;- match.call(expand.dots = FALSE)$...</span></span>
<span><span class="co">#&gt;     if (length(dots) &amp;&amp; !all(vapply(dots, function(x) is.symbol(x) || </span></span>
<span><span class="co">#&gt;         is.character(x), NA, USE.NAMES = FALSE))) </span></span>
<span><span class="co">#&gt;         stop("... must contain names or character strings")</span></span>
<span><span class="co">#&gt;     names &lt;- vapply(dots, as.character, "")</span></span>
<span><span class="co">#&gt;     if (length(names) == 0L) </span></span>
<span><span class="co">#&gt;         names &lt;- character()</span></span>
<span><span class="co">#&gt;     list &lt;- .Primitive("c")(list, names)</span></span>
<span><span class="co">#&gt;     .Internal(remove(list, envir, inherits))</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt; &lt;bytecode: 0x14ed91b98&gt;</span></span>
<span><span class="co">#&gt; &lt;environment: namespace:base&gt;</span></span></code></pre></div>
<p>I still couldn’t figure out why. I would recommend checking out the <a href="https://advanced-r-solutions.rbind.io/measuring-performance.html#profiling">official answer</a>.</p>
<hr>
</div>
<div id="microbenchmarking-exercises-23.3.3" class="section level2" number="23.2">
<h2>
<span class="header-section-number">23.2</span> Microbenchmarking (Exercises 23.3.3)<a class="anchor" aria-label="anchor" href="#microbenchmarking-exercises-23.3.3"><i class="fas fa-link"></i></a>
</h2>
<hr>
<p><strong>Q1.</strong> Instead of using <code><a href="http://bench.r-lib.org/reference/mark.html">bench::mark()</a></code>, you could use the built-in function <code><a href="https://rdrr.io/r/base/system.time.html">system.time()</a></code>. But <code><a href="https://rdrr.io/r/base/system.time.html">system.time()</a></code> is much less precise, so you’ll need to repeat each operation many times with a loop, and then divide to find the average time of each operation, as in the code below.</p>
<div class="sourceCode" id="cb641"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">1e6</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span><span class="op">(</span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="va">n</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span><span class="op">(</span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">)</span> <span class="va">x</span><span class="op">^</span><span class="fl">0.5</span><span class="op">)</span> <span class="op">/</span> <span class="va">n</span></span></code></pre></div>
<p>How do the estimates from <code><a href="https://rdrr.io/r/base/system.time.html">system.time()</a></code> compare to those from <code><a href="http://bench.r-lib.org/reference/mark.html">bench::mark()</a></code>? Why are they different?</p>
<p><strong>A1.</strong> Let’s benchmark first using these two approaches:</p>
<div class="sourceCode" id="cb642"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">1e6</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># bench -------------------</span></span>
<span></span>
<span><span class="va">bench_df</span> <span class="op">&lt;-</span> <span class="fu">bench</span><span class="fu">::</span><span class="fu"><a href="http://bench.r-lib.org/reference/mark.html">mark</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>  <span class="va">x</span><span class="op">^</span><span class="fl">0.5</span>,</span>
<span>  iterations <span class="op">=</span> <span class="va">n</span>,</span>
<span>  time_unit <span class="op">=</span> <span class="st">"us"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">t_bench_df</span> <span class="op">&lt;-</span> <span class="va">bench_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">expression</span>, <span class="va">time</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rowwise.html">rowwise</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>bench_mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="va">time</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">time</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># system.time -------------------</span></span>
<span></span>
<span><span class="co"># garbage collection performed immediately before the timing</span></span>
<span><span class="va">t1_systime_gc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span><span class="op">(</span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, gcFirst <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">/</span> <span class="va">n</span></span>
<span><span class="va">t2_systime_gc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span><span class="op">(</span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">)</span> <span class="va">x</span><span class="op">^</span><span class="fl">0.5</span>, gcFirst <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">/</span> <span class="va">n</span></span>
<span></span>
<span><span class="co"># garbage collection not performed immediately before the timing</span></span>
<span><span class="va">t1_systime_nogc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span><span class="op">(</span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, gcFirst <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">/</span> <span class="va">n</span></span>
<span><span class="va">t2_systime_nogc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span><span class="op">(</span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">)</span> <span class="va">x</span><span class="op">^</span><span class="fl">0.5</span>, gcFirst <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">/</span> <span class="va">n</span></span>
<span></span>
<span><span class="va">t_systime_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span></span>
<span>  <span class="st">"expression"</span> <span class="op">=</span> <span class="va">bench_df</span><span class="op">$</span><span class="va">expression</span>,</span>
<span>  <span class="st">"systime_with_gc"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">t1_systime_gc</span><span class="op">[</span><span class="st">"elapsed"</span><span class="op">]</span>, <span class="va">t2_systime_gc</span><span class="op">[</span><span class="st">"elapsed"</span><span class="op">]</span><span class="op">)</span>,</span>
<span>  <span class="st">"systime_with_nogc"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">t1_systime_nogc</span><span class="op">[</span><span class="st">"elapsed"</span><span class="op">]</span>, <span class="va">t2_systime_nogc</span><span class="op">[</span><span class="st">"elapsed"</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    systime_with_gc <span class="op">=</span> <span class="va">systime_with_gc</span> <span class="op">*</span> <span class="fl">1e6</span>, <span class="co"># in microseconds</span></span>
<span>    systime_with_nogc <span class="op">=</span> <span class="va">systime_with_nogc</span> <span class="op">*</span> <span class="fl">1e6</span> <span class="co"># in microseconds</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>Now we can compare results from these alternatives:</p>
<div class="sourceCode" id="cb643"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># note that system time columns report time in microseconds</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">full_join</a></span><span class="op">(</span><span class="va">t_bench_df</span>, <span class="va">t_systime_df</span>, by <span class="op">=</span> <span class="st">"expression"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 2 × 4</span></span>
<span><span class="co">#&gt;   expression bench_mean systime_with_gc systime_with_nogc</span></span>
<span><span class="co">#&gt;   &lt;bch:expr&gt;   &lt;bch:tm&gt;           &lt;dbl&gt;             &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 sqrt(x)      767.29ns           0.632             0.665</span></span>
<span><span class="co">#&gt; 2 x^0.5          2.45µs           2.27              2.33</span></span></code></pre></div>
<p>The comparison reveals that these two approaches yield quite similar results. Slight differences in exact values is possibly due to differences in the precision of timers used internally by these functions.</p>
<hr>
<p><strong>Q2.</strong> Here are two other ways to compute the square root of a vector. Which do you think will be fastest? Which will be slowest? Use microbenchmarking to test your answers.</p>
<div class="sourceCode" id="cb644"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">^</span><span class="op">(</span><span class="fl">1</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<hr>
<p><strong>A2.</strong> Microbenchmarking all ways to compute square root of a vector mentioned in this chapter.</p>
<div class="sourceCode" id="cb645"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">1000</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">bench</span><span class="fu">::</span><span class="fu"><a href="http://bench.r-lib.org/reference/mark.html">mark</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>  <span class="va">x</span><span class="op">^</span><span class="fl">0.5</span>,</span>
<span>  <span class="va">x</span><span class="op">^</span><span class="op">(</span><span class="fl">1</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>  iterations <span class="op">=</span> <span class="fl">1000</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">expression</span>, <span class="va">median</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">median</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 4 × 2</span></span>
<span><span class="co">#&gt;   expression      median</span></span>
<span><span class="co">#&gt;   &lt;bch:expr&gt;    &lt;bch:tm&gt;</span></span>
<span><span class="co">#&gt; 1 sqrt(x)         2.79µs</span></span>
<span><span class="co">#&gt; 2 exp(log(x)/2)   9.51µs</span></span>
<span><span class="co">#&gt; 3 x^(1/2)         17.9µs</span></span>
<span><span class="co">#&gt; 4 x^0.5          18.53µs</span></span></code></pre></div>
<p>The specialized primitive function <code><a href="https://rdrr.io/r/base/MathFun.html">sqrt()</a></code> (written in <code>C</code>) is the fastest way to compute square root.</p>
<hr>
</div>
<div id="session-information-17" class="section level2" number="23.3">
<h2>
<span class="header-section-number">23.3</span> Session information<a class="anchor" aria-label="anchor" href="#session-information-17"><i class="fas fa-link"></i></a>
</h2>
<div class="sourceCode" id="cb646"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">sessioninfo</span><span class="fu">::</span><span class="fu"><a href="https://r-lib.github.io/sessioninfo/reference/session_info.html">session_info</a></span><span class="op">(</span>include_base <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; ─ Session info ───────────────────────────────────────────</span></span>
<span><span class="co">#&gt;  setting  value</span></span>
<span><span class="co">#&gt;  version  R version 4.2.2 (2022-10-31)</span></span>
<span><span class="co">#&gt;  os       macOS Ventura 13.0</span></span>
<span><span class="co">#&gt;  system   aarch64, darwin20</span></span>
<span><span class="co">#&gt;  ui       X11</span></span>
<span><span class="co">#&gt;  language (EN)</span></span>
<span><span class="co">#&gt;  collate  en_US.UTF-8</span></span>
<span><span class="co">#&gt;  ctype    en_US.UTF-8</span></span>
<span><span class="co">#&gt;  tz       Europe/Berlin</span></span>
<span><span class="co">#&gt;  date     2022-11-12</span></span>
<span><span class="co">#&gt;  pandoc   2.19.2 @ /Applications/RStudio.app/Contents/MacOS/quarto/bin/tools/ (via rmarkdown)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ─ Packages ───────────────────────────────────────────────</span></span>
<span><span class="co">#&gt;  ! package     * version    date (UTC) lib source</span></span>
<span><span class="co">#&gt;    assertthat    0.2.1      2019-03-21 [1] CRAN (R 4.2.0)</span></span>
<span><span class="co">#&gt;    base        * 4.2.2      2022-10-31 [?] local</span></span>
<span><span class="co">#&gt;    bench         1.1.2      2021-11-30 [1] CRAN (R 4.2.0)</span></span>
<span><span class="co">#&gt;    bookdown      0.30       2022-11-09 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">#&gt;    bslib         0.4.1      2022-11-02 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">#&gt;    cachem        1.0.6      2021-08-19 [1] CRAN (R 4.2.0)</span></span>
<span><span class="co">#&gt;    cli           3.4.1      2022-09-23 [1] CRAN (R 4.2.0)</span></span>
<span><span class="co">#&gt;  P compiler      4.2.2      2022-10-31 [1] local</span></span>
<span><span class="co">#&gt;  P datasets    * 4.2.2      2022-10-31 [1] local</span></span>
<span><span class="co">#&gt;    DBI           1.1.3.9002 2022-10-17 [1] Github (r-dbi/DBI@2aec388)</span></span>
<span><span class="co">#&gt;    digest        0.6.30     2022-10-18 [1] CRAN (R 4.2.1)</span></span>
<span><span class="co">#&gt;    downlit       0.4.2      2022-07-05 [1] CRAN (R 4.2.1)</span></span>
<span><span class="co">#&gt;    dplyr       * 1.0.10     2022-09-01 [1] CRAN (R 4.2.1)</span></span>
<span><span class="co">#&gt;    evaluate      0.18       2022-11-07 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">#&gt;    fansi         1.0.3      2022-03-24 [1] CRAN (R 4.2.0)</span></span>
<span><span class="co">#&gt;    fastmap       1.1.0      2021-01-25 [1] CRAN (R 4.2.0)</span></span>
<span><span class="co">#&gt;    fs            1.5.2      2021-12-08 [1] CRAN (R 4.2.0)</span></span>
<span><span class="co">#&gt;    generics      0.1.3      2022-07-05 [1] CRAN (R 4.2.1)</span></span>
<span><span class="co">#&gt;    glue          1.6.2      2022-02-24 [1] CRAN (R 4.2.0)</span></span>
<span><span class="co">#&gt;  P graphics    * 4.2.2      2022-10-31 [1] local</span></span>
<span><span class="co">#&gt;  P grDevices   * 4.2.2      2022-10-31 [1] local</span></span>
<span><span class="co">#&gt;    htmltools     0.5.3      2022-07-18 [1] CRAN (R 4.2.1)</span></span>
<span><span class="co">#&gt;    htmlwidgets   1.5.4      2021-09-08 [1] CRAN (R 4.2.0)</span></span>
<span><span class="co">#&gt;    jquerylib     0.1.4      2021-04-26 [1] CRAN (R 4.2.0)</span></span>
<span><span class="co">#&gt;    jsonlite      1.8.3      2022-10-21 [1] CRAN (R 4.2.1)</span></span>
<span><span class="co">#&gt;    knitr         1.40       2022-08-24 [1] CRAN (R 4.2.1)</span></span>
<span><span class="co">#&gt;    lifecycle     1.0.3      2022-10-07 [1] CRAN (R 4.2.1)</span></span>
<span><span class="co">#&gt;    magrittr    * 2.0.3      2022-03-30 [1] CRAN (R 4.2.0)</span></span>
<span><span class="co">#&gt;    memoise       2.0.1      2021-11-26 [1] CRAN (R 4.2.0)</span></span>
<span><span class="co">#&gt;  P methods     * 4.2.2      2022-10-31 [1] local</span></span>
<span><span class="co">#&gt;    pillar        1.8.1      2022-08-19 [1] CRAN (R 4.2.1)</span></span>
<span><span class="co">#&gt;    pkgconfig     2.0.3      2019-09-22 [1] CRAN (R 4.2.0)</span></span>
<span><span class="co">#&gt;    profmem       0.6.0      2020-12-13 [1] CRAN (R 4.2.0)</span></span>
<span><span class="co">#&gt;    profvis     * 0.3.7      2020-11-02 [1] CRAN (R 4.2.0)</span></span>
<span><span class="co">#&gt;    R6            2.5.1.9000 2022-10-27 [1] local</span></span>
<span><span class="co">#&gt;    rlang         1.0.6      2022-09-24 [1] CRAN (R 4.2.1)</span></span>
<span><span class="co">#&gt;    rmarkdown     2.18       2022-11-09 [1] CRAN (R 4.2.2)</span></span>
<span><span class="co">#&gt;    rstudioapi    0.14       2022-08-22 [1] CRAN (R 4.2.1)</span></span>
<span><span class="co">#&gt;    sass          0.4.2      2022-07-16 [1] CRAN (R 4.2.1)</span></span>
<span><span class="co">#&gt;    sessioninfo   1.2.2      2021-12-06 [1] CRAN (R 4.2.0)</span></span>
<span><span class="co">#&gt;  P stats       * 4.2.2      2022-10-31 [1] local</span></span>
<span><span class="co">#&gt;    stringi       1.7.8      2022-07-11 [1] CRAN (R 4.2.1)</span></span>
<span><span class="co">#&gt;    stringr       1.4.1      2022-08-20 [1] CRAN (R 4.2.1)</span></span>
<span><span class="co">#&gt;    tibble        3.1.8.9002 2022-10-16 [1] local</span></span>
<span><span class="co">#&gt;    tidyselect    1.2.0      2022-10-10 [1] CRAN (R 4.2.1)</span></span>
<span><span class="co">#&gt;  P tools         4.2.2      2022-10-31 [1] local</span></span>
<span><span class="co">#&gt;    utf8          1.2.2      2021-07-24 [1] CRAN (R 4.2.0)</span></span>
<span><span class="co">#&gt;  P utils       * 4.2.2      2022-10-31 [1] local</span></span>
<span><span class="co">#&gt;    vctrs         0.5.0      2022-10-22 [1] CRAN (R 4.2.1)</span></span>
<span><span class="co">#&gt;    withr         2.5.0      2022-03-03 [1] CRAN (R 4.2.0)</span></span>
<span><span class="co">#&gt;    xfun          0.34       2022-10-18 [1] CRAN (R 4.2.1)</span></span>
<span><span class="co">#&gt;    xml2          1.3.3.9000 2022-10-10 [1] local</span></span>
<span><span class="co">#&gt;    yaml          2.3.6      2022-10-18 [1] CRAN (R 4.2.1)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  [1] /Library/Frameworks/R.framework/Versions/4.2-arm64/Resources/library</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  P ── Loaded and on-disk path mismatch.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ──────────────────────────────────────────────────────────</span></span></code></pre></div>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="debugging.html"><span class="header-section-number">22</span> Debugging</a></div>
<div class="next"><a href="improving-performance.html"><span class="header-section-number">24</span> Improving performance</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#measuring-performance"><span class="header-section-number">23</span> Measuring performance</a></li>
<li><a class="nav-link" href="#profiling-exercises-23.2.4"><span class="header-section-number">23.1</span> Profiling (Exercises 23.2.4)</a></li>
<li><a class="nav-link" href="#microbenchmarking-exercises-23.3.3"><span class="header-section-number">23.2</span> Microbenchmarking (Exercises 23.3.3)</a></li>
<li><a class="nav-link" href="#session-information-17"><span class="header-section-number">23.3</span> Session information</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/IndrajeetPatil/Advanced-R-exercises/blob/master/Perf-measure.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/IndrajeetPatil/Advanced-R-exercises/edit/master/Perf-measure.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Advanced R Exercises</strong>" was written by <a class="text-light" href="https://sites.google.com/site/indrajeetspatilmorality/">Indrajeet Patil</a>. It was last built on 2022-11-12.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
