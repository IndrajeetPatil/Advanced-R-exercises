<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 8 Conditions | Advanced R Exercises</title>
<meta name="author" content="Indrajeet Patil">
<meta name="description" content="8.0.1 Exercises 8.2.4 Q1. Write a wrapper around file.remove() that throws an error if the file to be deleted does not exist. A1. Let’s first create a wrapper function around file.remove() that...">
<meta name="generator" content="bookdown 0.27 with bs4_book()">
<meta property="og:title" content="Chapter 8 Conditions | Advanced R Exercises">
<meta property="og:type" content="book">
<meta property="og:image" content="/cover.png">
<meta property="og:description" content="8.0.1 Exercises 8.2.4 Q1. Write a wrapper around file.remove() that throws an error if the file to be deleted does not exist. A1. Let’s first create a wrapper function around file.remove() that...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 8 Conditions | Advanced R Exercises">
<meta name="twitter:description" content="8.0.1 Exercises 8.2.4 Q1. Write a wrapper around file.remove() that throws an error if the file to be deleted does not exist. A1. Let’s first create a wrapper function around file.remove() that...">
<meta name="twitter:image" content="/cover.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.4.0/transition.js"></script><script src="libs/bs3compat-0.4.0/tabs.js"></script><script src="libs/bs3compat-0.4.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="bs4_style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Advanced R Exercises</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled"><li><a class="" href="index.html"><span class="header-section-number">Chapter 8</span> Conditions</a></li></ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/IndrajeetPatil/Advanced-R-exercises">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="conditions" class="section level1" number="8">
<h1>
<span class="header-section-number">8</span> Conditions<a class="anchor" aria-label="anchor" href="#conditions"><i class="fas fa-link"></i></a>
</h1>
<div id="exercises-8.2.4" class="section level3" number="8.0.1">
<h3>
<span class="header-section-number">8.0.1</span> Exercises 8.2.4<a class="anchor" aria-label="anchor" href="#exercises-8.2.4"><i class="fas fa-link"></i></a>
</h3>
<p><strong>Q1.</strong> Write a wrapper around <code><a href="https://rdrr.io/r/base/files.html">file.remove()</a></code> that throws an error if the file to be deleted does not exist.</p>
<p><strong>A1.</strong> Let’s first create a wrapper function around <code><a href="https://rdrr.io/r/base/files.html">file.remove()</a></code> that throws an error if the file to be deleted does not exist.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fileRemove</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">existing_files</span> <span class="op">&lt;-</span> <span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/file_access.html">file_exists</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span></span>
<span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/all.html">all</a></span><span class="op">(</span><span class="va">existing_files</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span></span>
<span>        <span class="st">"The following files to be deleted don't exist:"</span>,</span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">existing_files</span><span class="op">[</span><span class="op">!</span><span class="va">existing_files</span><span class="op">]</span><span class="op">)</span>,</span>
<span>        sep <span class="op">=</span> <span class="st">"\n"</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/files.html">file.remove</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Let’s first create a file that we can delete immediately.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/create.html">file_create</a></span><span class="op">(</span><span class="st">"random.R"</span><span class="op">)</span></span></code></pre></div>
<p>The function should fail if there are any other files provided that don’t exist:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">fileRemove</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"random.R"</span>, <span class="st">"XYZ.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; The following files to be deleted don't exist:</span></span>
<span><span class="co">#&gt; XYZ.csv</span></span>
<span><span class="co">#&gt; Error in fileRemove(c("random.R", "XYZ.csv")):</span></span></code></pre></div>
<p>But does work as expected when the file exists:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">fileRemove</span><span class="op">(</span><span class="st">"random.R"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p><strong>Q2.</strong> What does the <code>appendLF</code> argument to <code><a href="https://rdrr.io/r/base/message.html">message()</a></code> do? How is it related to <code><a href="https://rdrr.io/r/base/cat.html">cat()</a></code>?</p>
<p><strong>A2.</strong> As mentioned in the docs for <code><a href="https://rdrr.io/r/base/message.html">message()</a></code>, <code>appendLF</code> argument decides:</p>
<blockquote>
<p>should messages given as a character string have a newline appended?</p>
</blockquote>
<ul>
<li>If <code>TRUE</code>, a final newline is regarded as part of the message:</li>
</ul>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/message.html">message</a></span><span class="op">(</span><span class="st">"Beetle"</span>, appendLF <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Beetle</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html">message</a></span><span class="op">(</span><span class="st">"Juice"</span>, appendLF <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Juice</span></span></code></pre></div>
<ul>
<li>If <code>FALSE</code>, messages will be concatenated:</li>
</ul>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/message.html">message</a></span><span class="op">(</span><span class="st">"Beetle"</span>, appendLF <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Beetle</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html">message</a></span><span class="op">(</span><span class="st">"Juice"</span>, appendLF <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Juice</span></span></code></pre></div>
<p>On the other hand, <code><a href="https://rdrr.io/r/base/cat.html">cat()</a></code> converts its arguments to character vectors and concatenates them to a single character vector by default:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Beetle"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Beetle</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Juice"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Juice</span></span></code></pre></div>
<p>In order to get output <code><a href="https://rdrr.io/r/base/message.html">message()</a></code>-like default behavior, we can set <code>sep = "\n"</code>:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Beetle"</span>, sep <span class="op">=</span> <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Beetle</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Juice"</span>, sep <span class="op">=</span> <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Juice</span></span></code></pre></div>
</div>
<div id="exercises-8.4.5" class="section level3" number="8.0.2">
<h3>
<span class="header-section-number">8.0.2</span> Exercises 8.4.5<a class="anchor" aria-label="anchor" href="#exercises-8.4.5"><i class="fas fa-link"></i></a>
</h3>
<p><strong>Q1.</strong> What extra information does the condition generated by <code><a href="https://rlang.r-lib.org/reference/abort.html">abort()</a></code> contain compared to the condition generated by <code><a href="https://rdrr.io/r/base/stop.html">stop()</a></code> i.e. what’s the difference between these two objects? Read the help for <code><a href="https://rlang.r-lib.org/reference/abort.html">?abort</a></code> to learn more.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rlang.r-lib.org/reference/catch_cnd.html">catch_cnd</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="st">"An error"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rlang.r-lib.org/reference/catch_cnd.html">catch_cnd</a></span><span class="op">(</span><span class="fu"><a href="https://rlang.r-lib.org/reference/abort.html">abort</a></span><span class="op">(</span><span class="st">"An error"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><strong>A1.</strong> Contrasting these two lists, we can see that <code><a href="https://rlang.r-lib.org/reference/abort.html">rlang::abort()</a></code> contains two additional pieces of information:</p>
<ul>
<li>
<code>trace</code>: A traceback capturing the sequence of calls that lead to the current function</li>
<li>
<code>parent</code>: Information about another condition used as a parent to create a chained condition.</li>
</ul>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rlang.r-lib.org">rlang</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'rlang'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:magrittr':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     set_names</span></span>
<span></span>
<span><span class="va">stopInfo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rlang.r-lib.org/reference/catch_cnd.html">catch_cnd</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="st">"An error"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">abortInfo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rlang.r-lib.org/reference/catch_cnd.html">catch_cnd</a></span><span class="op">(</span><span class="fu"><a href="https://rlang.r-lib.org/reference/abort.html">abort</a></span><span class="op">(</span><span class="st">"An error"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">stopInfo</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 2</span></span>
<span><span class="co">#&gt;  $ message: chr "An error"</span></span>
<span><span class="co">#&gt;  $ call   : language force(expr)</span></span>
<span><span class="co">#&gt;  - attr(*, "class")= chr [1:3] "simpleError" "error" "condition"</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">abortInfo</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 4</span></span>
<span><span class="co">#&gt;  $ message: chr "An error"</span></span>
<span><span class="co">#&gt;  $ trace  :Classes 'rlang_trace', 'rlib_trace', 'tbl' and 'data.frame':  8 obs. of  6 variables:</span></span>
<span><span class="co">#&gt;   ..$ call       :List of 8</span></span>
<span><span class="co">#&gt;   .. ..$ : language catch_cnd(abort("An error"))</span></span>
<span><span class="co">#&gt;   .. ..$ : language eval_bare(rlang::expr(tryCatch(!!!handlers, {     force(expr) ...</span></span>
<span><span class="co">#&gt;   .. ..$ : language tryCatch(condition = `&lt;fn&gt;`, {     force(expr) ...</span></span>
<span><span class="co">#&gt;   .. ..$ : language tryCatchList(expr, classes, parentenv, handlers)</span></span>
<span><span class="co">#&gt;   .. ..$ : language tryCatchOne(expr, names, parentenv, handlers[[1L]])</span></span>
<span><span class="co">#&gt;   .. ..$ : language doTryCatch(return(expr), name, parentenv, handler)</span></span>
<span><span class="co">#&gt;   .. ..$ : language force(expr)</span></span>
<span><span class="co">#&gt;   .. ..$ : language abort("An error")</span></span>
<span><span class="co">#&gt;   ..$ parent     : int [1:8] 0 1 1 3 4 5 1 0</span></span>
<span><span class="co">#&gt;   ..$ visible    : logi [1:8] FALSE FALSE FALSE FALSE FALSE FALSE ...</span></span>
<span><span class="co">#&gt;   ..$ namespace  : chr [1:8] "rlang" "rlang" "base" "base" ...</span></span>
<span><span class="co">#&gt;   ..$ scope      : chr [1:8] "::" "::" "::" "local" ...</span></span>
<span><span class="co">#&gt;   ..$ error_frame: logi [1:8] FALSE FALSE FALSE FALSE FALSE FALSE ...</span></span>
<span><span class="co">#&gt;   ..- attr(*, "version")= int 2</span></span>
<span><span class="co">#&gt;  $ parent : NULL</span></span>
<span><span class="co">#&gt;  $ call   : NULL</span></span>
<span><span class="co">#&gt;  - attr(*, "class")= chr [1:3] "rlang_error" "error" "condition"</span></span></code></pre></div>
<p><strong>Q2.</strong> Predict the results of evaluating the following code</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">show_condition</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">code</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/conditions.html">tryCatch</a></span><span class="op">(</span></span>
<span>    error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">cnd</span><span class="op">)</span> <span class="st">"error"</span>,</span>
<span>    warning <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">cnd</span><span class="op">)</span> <span class="st">"warning"</span>,</span>
<span>    message <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">cnd</span><span class="op">)</span> <span class="st">"message"</span>,</span>
<span>    <span class="op">{</span></span>
<span>      <span class="va">code</span></span>
<span>      <span class="cn">NULL</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">show_condition</span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="st">"!"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">show_condition</span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="fu">show_condition</span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/warning.html">warning</a></span><span class="op">(</span><span class="st">"?!"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">show_condition</span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="fl">10</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html">message</a></span><span class="op">(</span><span class="st">"?"</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/warning.html">warning</a></span><span class="op">(</span><span class="st">"?!"</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p><strong>A2.</strong> Correctly predicted 😉</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">show_condition</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">code</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/conditions.html">tryCatch</a></span><span class="op">(</span></span>
<span>    error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">cnd</span><span class="op">)</span> <span class="st">"error"</span>,</span>
<span>    warning <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">cnd</span><span class="op">)</span> <span class="st">"warning"</span>,</span>
<span>    message <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">cnd</span><span class="op">)</span> <span class="st">"message"</span>,</span>
<span>    <span class="op">{</span></span>
<span>      <span class="va">code</span></span>
<span>      <span class="cn">NULL</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">show_condition</span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="st">"!"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "error"</span></span>
<span><span class="fu">show_condition</span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt; NULL</span></span>
<span><span class="fu">show_condition</span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/warning.html">warning</a></span><span class="op">(</span><span class="st">"?!"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "warning"</span></span>
<span><span class="fu">show_condition</span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="fl">10</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html">message</a></span><span class="op">(</span><span class="st">"?"</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/warning.html">warning</a></span><span class="op">(</span><span class="st">"?!"</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "message"</span></span></code></pre></div>
<p>The last piece of code is the challenging one and it illustrates how <code><a href="https://rdrr.io/r/base/conditions.html">tryCatch()</a></code> works. From its docs:</p>
<blockquote>
<p>When several handlers are supplied in a single tryCatch then the first one is considered more recent than the second.</p>
</blockquote>
<p><strong>Q3.</strong> Explain the results of running this code:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/conditions.html">withCallingHandlers</a></span><span class="op">(</span></span>
<span>  message <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">cnd</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/message.html">message</a></span><span class="op">(</span><span class="st">"b"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/conditions.html">withCallingHandlers</a></span><span class="op">(</span></span>
<span>    message <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">cnd</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/message.html">message</a></span><span class="op">(</span><span class="st">"a"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/message.html">message</a></span><span class="op">(</span><span class="st">"c"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; b</span></span>
<span><span class="co">#&gt; a</span></span>
<span><span class="co">#&gt; b</span></span>
<span><span class="co">#&gt; c</span></span></code></pre></div>
<p><strong>A3.</strong> The surprising part of this output is the <code>b</code> before the last <code>c</code>.</p>
<p>This happens because the inner calling handler doesn’t handle the message, so it bubbles up to the outer calling handler.</p>
<p><strong>Q4.</strong> Read the source code for <code><a href="https://rlang.r-lib.org/reference/catch_cnd.html">catch_cnd()</a></code> and explain how it works.</p>
<p><strong>A4.</strong> Let’s look at the source code for <code><a href="https://rlang.r-lib.org/reference/catch_cnd.html">catch_cnd()</a></code>:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">rlang</span><span class="fu">::</span><span class="va"><a href="https://rlang.r-lib.org/reference/catch_cnd.html">catch_cnd</a></span></span>
<span><span class="co">#&gt; function (expr, classes = "condition") </span></span>
<span><span class="co">#&gt; {</span></span>
<span><span class="co">#&gt;     stopifnot(is_character(classes))</span></span>
<span><span class="co">#&gt;     handlers &lt;- rep_named(classes, list(identity))</span></span>
<span><span class="co">#&gt;     eval_bare(rlang::expr(tryCatch(!!!handlers, {</span></span>
<span><span class="co">#&gt;         force(expr)</span></span>
<span><span class="co">#&gt;         return(NULL)</span></span>
<span><span class="co">#&gt;     })))</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt; &lt;bytecode: 0x120dccee0&gt;</span></span>
<span><span class="co">#&gt; &lt;environment: namespace:rlang&gt;</span></span></code></pre></div>
<p>As mentioned in the function docs:</p>
<blockquote>
<p>This is a small wrapper around <code><a href="https://rdrr.io/r/base/conditions.html">tryCatch()</a></code> that captures any condition signalled while evaluating its argument.</p>
</blockquote>
<p>The <code>classes</code> argument allows a character vector of condition classes to catch, and the complex tidy evaluation generates the necessary condition (if there is any; otherwise <code>NULL</code>).</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rlang.r-lib.org/reference/catch_cnd.html">catch_cnd</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt; NULL</span></span>
<span></span>
<span><span class="fu"><a href="https://rlang.r-lib.org/reference/catch_cnd.html">catch_cnd</a></span><span class="op">(</span><span class="fu"><a href="https://rlang.r-lib.org/reference/abort.html">abort</a></span><span class="op">(</span>message <span class="op">=</span> <span class="st">"an error"</span>, class <span class="op">=</span> <span class="st">"my class"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;error/my class&gt;</span></span>
<span><span class="co">#&gt; Error:</span></span>
<span><span class="co">#&gt; ! an error</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Backtrace:</span></span>
<span></span>
<span><span class="fu"><a href="https://rlang.r-lib.org/reference/catch_cnd.html">catch_cnd</a></span><span class="op">(</span><span class="fu"><a href="https://rlang.r-lib.org/reference/abort.html">abort</a></span><span class="op">(</span><span class="st">"an error"</span><span class="op">)</span>, classes <span class="op">=</span> <span class="st">"message"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error:</span></span>
<span><span class="co">#&gt; ! an error</span></span></code></pre></div>
<p><strong>Q5.</strong> How could you rewrite <code>show_condition()</code> to use a single handler?</p>
<p><strong>A5.</strong> The source code for <code>rlang::catch_cond()</code> gives us a clue as to how we can do this.</p>
<p>Conditions also have a <code>class</code> attribute, and we can use it to determine which handler will match the condition.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">show_condition2</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">code</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/conditions.html">tryCatch</a></span><span class="op">(</span></span>
<span>    condition <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">cnd</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/class.html">inherits</a></span><span class="op">(</span><span class="va">cnd</span>, <span class="st">"error"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="st">"error"</span><span class="op">)</span></span>
<span>      <span class="op">}</span></span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/class.html">inherits</a></span><span class="op">(</span><span class="va">cnd</span>, <span class="st">"warning"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="st">"warning"</span><span class="op">)</span></span>
<span>      <span class="op">}</span></span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/class.html">inherits</a></span><span class="op">(</span><span class="va">cnd</span>, <span class="st">"message"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="st">"message"</span><span class="op">)</span></span>
<span>      <span class="op">}</span></span>
<span>    <span class="op">}</span>,</span>
<span>    <span class="op">{</span></span>
<span>      <span class="va">code</span></span>
<span>      <span class="cn">NULL</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Let’s try this new version with the examples from original version:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">show_condition2</span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="st">"!"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "error"</span></span>
<span><span class="fu">show_condition2</span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt; NULL</span></span>
<span><span class="fu">show_condition2</span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/warning.html">warning</a></span><span class="op">(</span><span class="st">"?!"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "warning"</span></span>
<span><span class="fu">show_condition2</span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="fl">10</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html">message</a></span><span class="op">(</span><span class="st">"?"</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/warning.html">warning</a></span><span class="op">(</span><span class="st">"?!"</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "message"</span></span></code></pre></div>
</div>
<div id="exercises-8.5.4" class="section level3" number="8.0.3">
<h3>
<span class="header-section-number">8.0.3</span> Exercises 8.5.4<a class="anchor" aria-label="anchor" href="#exercises-8.5.4"><i class="fas fa-link"></i></a>
</h3>
<p><strong>Q1.</strong> Inside a package, it’s occasionally useful to check that a package is installed before using it. Write a function that checks if a package is installed (with <code>requireNamespace("pkg", quietly = FALSE))</code> and if not, throws a custom condition that includes the package name in the metadata.</p>
<p><strong>Q2.</strong> Inside a package you often need to stop with an error when something is not right. Other packages that depend on your package might be tempted to check these errors in their unit tests. How could you help these packages to avoid relying on the error message which is part of the user interface rather than the API and might change without notice?</p>
</div>
<div id="exercises-8.6.6" class="section level3" number="8.0.4">
<h3>
<span class="header-section-number">8.0.4</span> Exercises 8.6.6<a class="anchor" aria-label="anchor" href="#exercises-8.6.6"><i class="fas fa-link"></i></a>
</h3>
<p><strong>Q1.</strong> Create <code>suppressConditions()</code> that works like <code><a href="https://rdrr.io/r/base/message.html">suppressMessages()</a></code> and <code><a href="https://rdrr.io/r/base/warning.html">suppressWarnings()</a></code> but suppresses everything. Think carefully about how you should handle errors.</p>
<p><strong>Q2.</strong> Compare the following two implementations of <code>message2error()</code>. What is the main advantage of <code><a href="https://rdrr.io/r/base/conditions.html">withCallingHandlers()</a></code> in this scenario? (Hint: look carefully at the traceback.)</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">message2error</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">code</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/conditions.html">withCallingHandlers</a></span><span class="op">(</span><span class="va">code</span>, message <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="va">e</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">message2error</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">code</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/conditions.html">tryCatch</a></span><span class="op">(</span><span class="va">code</span>, message <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="va">e</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><strong>Q3.</strong> How would you modify the <code>catch_cnds()</code> definition if you wanted to recreate the original intermingling of warnings and messages?</p>
<p><strong>Q4.</strong> Why is catching interrupts dangerous? Run this code to find out.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bottles_of_beer</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">i</span> <span class="op">=</span> <span class="fl">99</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html">message</a></span><span class="op">(</span></span>
<span>    <span class="st">"There are "</span>, <span class="va">i</span>, <span class="st">" bottles of beer on the wall, "</span>,</span>
<span>    <span class="va">i</span>, <span class="st">" bottles of beer."</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="kw">while</span> <span class="op">(</span><span class="va">i</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/conditions.html">tryCatch</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/Sys.sleep.html">Sys.sleep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>      interrupt <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">err</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">i</span> <span class="op">&lt;&lt;-</span> <span class="va">i</span> <span class="op">-</span> <span class="fl">1</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="va">i</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>          <span class="fu"><a href="https://rdrr.io/r/base/message.html">message</a></span><span class="op">(</span></span>
<span>            <span class="st">"Take one down, pass it around, "</span>, <span class="va">i</span>,</span>
<span>            <span class="st">" bottle"</span>, <span class="kw">if</span> <span class="op">(</span><span class="va">i</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span> <span class="st">"s"</span>, <span class="st">" of beer on the wall."</span></span>
<span>          <span class="op">)</span></span>
<span>        <span class="op">}</span></span>
<span>      <span class="op">}</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html">message</a></span><span class="op">(</span></span>
<span>    <span class="st">"No more bottles of beer on the wall, "</span>,</span>
<span>    <span class="st">"no more bottles of beer."</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>

</div>
</div>
  <div class="chapter-nav">
<div class="empty"></div>
<div class="empty"></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <div id="book-on-this-page"></div>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Advanced R Exercises</strong>" was written by <a class="text-light" href="https://sites.google.com/site/indrajeetspatilmorality/">Indrajeet Patil</a>. It was last built on 2022-07-26.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>
</body>
</html>
