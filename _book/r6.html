<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 14 R6 | Advanced R Exercises</title>
<meta name="author" content="Indrajeet Patil">
<meta name="description" content="14.1 Exercise 14.2.6 Q1. Create a bank account R6 class that stores a balance and allows you to deposit and withdraw money. Create a subclass that throws an error if you attempt to go into...">
<meta name="generator" content="bookdown 0.25 with bs4_book()">
<meta property="og:title" content="Chapter 14 R6 | Advanced R Exercises">
<meta property="og:type" content="book">
<meta property="og:image" content="/cover.png">
<meta property="og:description" content="14.1 Exercise 14.2.6 Q1. Create a bank account R6 class that stores a balance and allows you to deposit and withdraw money. Create a subclass that throws an error if you attempt to go into...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 14 R6 | Advanced R Exercises">
<meta name="twitter:description" content="14.1 Exercise 14.2.6 Q1. Create a bank account R6 class that stores a balance and allows you to deposit and withdraw money. Create a subclass that throws an error if you attempt to go into...">
<meta name="twitter:image" content="/cover.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.1/transition.js"></script><script src="libs/bs3compat-0.3.1/tabs.js"></script><script src="libs/bs3compat-0.3.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="bs4_style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Advanced R Exercises</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">About</a></li>
<li><a class="" href="introduction.html"><span class="header-section-number">1</span> Introduction</a></li>
<li><a class="" href="names-and-values.html"><span class="header-section-number">2</span> Names and values</a></li>
<li><a class="" href="vectors.html"><span class="header-section-number">3</span> Vectors</a></li>
<li><a class="" href="subsetting.html"><span class="header-section-number">4</span> Subsetting</a></li>
<li><a class="" href="control-flow.html"><span class="header-section-number">5</span> Control flow</a></li>
<li><a class="" href="functions.html"><span class="header-section-number">6</span> Functions</a></li>
<li><a class="" href="environments.html"><span class="header-section-number">7</span> Environments</a></li>
<li><a class="" href="conditions.html"><span class="header-section-number">8</span> Conditions</a></li>
<li><a class="" href="functionals.html"><span class="header-section-number">9</span> Functionals</a></li>
<li><a class="" href="function-factories.html"><span class="header-section-number">10</span> Function factories</a></li>
<li><a class="" href="function-operators.html"><span class="header-section-number">11</span> Function operators</a></li>
<li><a class="" href="base-types.html"><span class="header-section-number">12</span> Base Types</a></li>
<li><a class="" href="s3.html"><span class="header-section-number">13</span> S3</a></li>
<li><a class="active" href="r6.html"><span class="header-section-number">14</span> R6</a></li>
<li><a class="" href="s4.html"><span class="header-section-number">15</span> S4</a></li>
<li><a class="" href="trade-offs.html"><span class="header-section-number">16</span> Trade-offs</a></li>
<li><a class="" href="big-picture.html"><span class="header-section-number">17</span> Big Picture</a></li>
<li><a class="" href="expressions.html"><span class="header-section-number">18</span> Expressions</a></li>
<li><a class="" href="quotation.html"><span class="header-section-number">19</span> Quotation</a></li>
<li><a class="" href="debugging.html"><span class="header-section-number">20</span> Debugging</a></li>
<li><a class="" href="measuring-performance.html"><span class="header-section-number">21</span> Measuring performance</a></li>
<li><a class="" href="improving-performance.html"><span class="header-section-number">22</span> Improving performance</a></li>
<li><a class="" href="rewriting-r-code-in-c.html"><span class="header-section-number">23</span> Rewriting R code in C++</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/IndrajeetPatil/Advanced-R-exercises">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="r6" class="section level1" number="14">
<h1>
<span class="header-section-number">14</span> R6<a class="anchor" aria-label="anchor" href="#r6"><i class="fas fa-link"></i></a>
</h1>
<div id="exercise-14.2.6" class="section level2" number="14.1">
<h2>
<span class="header-section-number">14.1</span> Exercise 14.2.6<a class="anchor" aria-label="anchor" href="#exercise-14.2.6"><i class="fas fa-link"></i></a>
</h2>
<p><strong>Q1.</strong> Create a bank account R6 class that stores a balance and allows you to deposit and withdraw money. Create a subclass that throws an error if you attempt to go into overdraft. Create another subclass that allows you to go into overdraft, but charges you a fee. Create the superclass and make sure it works as expected.</p>
<p><strong>A1.</strong></p>
<div class="sourceCode" id="cb227"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r6.r-lib.org">R6</a></span><span class="op">)</span>

<span class="co"># define the needed class</span>
<span class="va">bankAccount</span> <span class="op">&lt;-</span> <span class="fu">R6</span><span class="fu">::</span><span class="kw"><a href="https://r6.r-lib.org/reference/R6Class.html">R6Class</a></span><span class="op">(</span>
  <span class="st">"bankAccount"</span>,
  public <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    <span class="co"># fields -----------------------</span>
    balance <span class="op">=</span> <span class="cn">NA</span>,
    name <span class="op">=</span> <span class="cn">NA</span>,

    <span class="co"># methods ----------------------</span>
    initialize <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">name</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">balance</span><span class="op">)</span> <span class="op">{</span>
      <span class="va">self</span><span class="op">$</span><span class="fu">validate</span><span class="op">(</span><span class="va">balance</span><span class="op">)</span>

      <span class="va">self</span><span class="op">$</span><span class="va">name</span> <span class="op">&lt;-</span> <span class="va">name</span>
      <span class="va">self</span><span class="op">$</span><span class="va">balance</span> <span class="op">&lt;-</span> <span class="va">balance</span>
    <span class="op">}</span>,
    deposit <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">amount</span><span class="op">)</span> <span class="op">{</span>
      <span class="va">self</span><span class="op">$</span><span class="fu">validate</span><span class="op">(</span><span class="va">amount</span><span class="op">)</span>
      <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Current balance is: "</span>, <span class="va">self</span><span class="op">$</span><span class="va">balance</span>, <span class="st">"\n"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>
      <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"And you are depositing: "</span>, <span class="va">amount</span><span class="op">)</span>
      <span class="va">self</span><span class="op">$</span><span class="va">balance</span> <span class="op">&lt;-</span> <span class="va">self</span><span class="op">$</span><span class="va">balance</span> <span class="op">+</span> <span class="va">amount</span>
      <span class="fu"><a href="https://rdrr.io/r/base/invisible.html">invisible</a></span><span class="op">(</span><span class="va">self</span><span class="op">)</span>
    <span class="op">}</span>,
    withdraw <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">amount</span><span class="op">)</span> <span class="op">{</span>
      <span class="va">self</span><span class="op">$</span><span class="fu">validate</span><span class="op">(</span><span class="va">amount</span><span class="op">)</span>
      <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Current balance is: "</span>, <span class="va">self</span><span class="op">$</span><span class="va">balance</span>, <span class="st">"\n"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>
      <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"And you are withdrawing: "</span>, <span class="va">amount</span>, <span class="st">"\n"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>
      <span class="va">self</span><span class="op">$</span><span class="va">balance</span> <span class="op">&lt;-</span> <span class="va">self</span><span class="op">$</span><span class="va">balance</span> <span class="op">-</span> <span class="va">amount</span>
      <span class="fu"><a href="https://rdrr.io/r/base/invisible.html">invisible</a></span><span class="op">(</span><span class="va">self</span><span class="op">)</span>
    <span class="op">}</span>,
    validate <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">amount</span><span class="op">)</span> <span class="op">{</span>
      <span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">is.numeric</a></span><span class="op">(</span><span class="va">amount</span><span class="op">)</span>, <span class="va">amount</span> <span class="op">&gt;=</span> <span class="fl">0</span><span class="op">)</span>
    <span class="op">}</span>,
    print <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span>
      <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Dear "</span>, <span class="va">self</span><span class="op">$</span><span class="va">name</span>, <span class="st">", your balance is: "</span>, <span class="va">self</span><span class="op">$</span><span class="va">balance</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>
      <span class="fu"><a href="https://rdrr.io/r/base/invisible.html">invisible</a></span><span class="op">(</span><span class="va">self</span><span class="op">)</span>
    <span class="op">}</span>
  <span class="op">)</span>
<span class="op">)</span>

<span class="co"># create an instance of an object</span>
<span class="va">indra</span> <span class="op">&lt;-</span> <span class="va">bankAccount</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Indra"</span>, balance <span class="op">=</span> <span class="fl">100</span><span class="op">)</span>

<span class="va">indra</span>
<span class="co">#&gt; Dear Indra, your balance is: 100</span>

<span class="co"># do deposits and withdrawals to see if the balance changes</span>
<span class="va">indra</span><span class="op">$</span><span class="fu">deposit</span><span class="op">(</span><span class="fl">20</span><span class="op">)</span>
<span class="co">#&gt; Current balance is: 100</span>
<span class="co">#&gt; And you are depositing:  20</span>

<span class="va">indra</span>
<span class="co">#&gt; Dear Indra, your balance is: 120</span>

<span class="va">indra</span><span class="op">$</span><span class="fu">withdraw</span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>
<span class="co">#&gt; Current balance is: 120</span>
<span class="co">#&gt; And you are withdrawing: 10</span>

<span class="va">indra</span>
<span class="co">#&gt; Dear Indra, your balance is: 110</span>

<span class="co"># make sure input validation checks work</span>
<span class="va">indra</span><span class="op">$</span><span class="fu">deposit</span><span class="op">(</span><span class="op">-</span><span class="fl">20</span><span class="op">)</span>
<span class="co">#&gt; Error in self$validate(amount): amount &gt;= 0 is not TRUE</span>
<span class="va">indra</span><span class="op">$</span><span class="fu">deposit</span><span class="op">(</span><span class="st">"pizza"</span><span class="op">)</span>
<span class="co">#&gt; Error in self$validate(amount): is.numeric(amount) is not TRUE</span>
<span class="va">indra</span><span class="op">$</span><span class="fu">withdraw</span><span class="op">(</span><span class="op">-</span><span class="fl">54</span><span class="op">)</span>
<span class="co">#&gt; Error in self$validate(amount): amount &gt;= 0 is not TRUE</span>
<span class="va">Anne</span> <span class="op">&lt;-</span> <span class="va">bankAccount</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Anne"</span>, balance <span class="op">=</span> <span class="op">-</span><span class="fl">45</span><span class="op">)</span>
<span class="co">#&gt; Error in self$validate(balance): amount &gt;= 0 is not TRUE</span></code></pre></div>
<p>Create a subclass that errors if you attempt to overdraw</p>
<div class="sourceCode" id="cb228"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bankAccountStrict</span> <span class="op">&lt;-</span> <span class="fu">R6</span><span class="fu">::</span><span class="kw"><a href="https://r6.r-lib.org/reference/R6Class.html">R6Class</a></span><span class="op">(</span>
  <span class="st">"bankAccountStrict"</span>,
  inherit <span class="op">=</span> <span class="va">bankAccount</span>,
  public <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    withdraw <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">amount</span><span class="op">)</span> <span class="op">{</span>
      <span class="co"># use method from superclass</span>
      <span class="va">super</span><span class="op">$</span><span class="fu">withdraw</span><span class="op">(</span><span class="va">amount</span><span class="op">)</span>

      <span class="kw">if</span> <span class="op">(</span><span class="va">self</span><span class="op">$</span><span class="va">balance</span> <span class="op">&lt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span>
        <span class="fu"><a href="https://rdrr.io/r/base/invisible.html">invisible</a></span><span class="op">(</span><span class="va">self</span><span class="op">)</span>
        <span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span>
          <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\nYou are trying to withdraw more that your balance.\n"</span><span class="op">)</span>,
          <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"I'm sorry, "</span>, <span class="va">self</span><span class="op">$</span><span class="va">name</span>, <span class="st">", I'm afraid I can't do that."</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>,
          call. <span class="op">=</span> <span class="cn">FALSE</span>
        <span class="op">)</span>
      <span class="op">}</span>
    <span class="op">}</span>
  <span class="op">)</span>
<span class="op">)</span>

<span class="co"># create an instance of an object</span>
<span class="va">Pritesh</span> <span class="op">&lt;-</span> <span class="va">bankAccountStrict</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Pritesh"</span>, balance <span class="op">=</span> <span class="fl">100</span><span class="op">)</span>

<span class="va">Pritesh</span>
<span class="co">#&gt; Dear Pritesh, your balance is: 100</span>

<span class="co"># do deposits and withdrawals to see if the balance changes</span>
<span class="va">Pritesh</span><span class="op">$</span><span class="fu">deposit</span><span class="op">(</span><span class="fl">20</span><span class="op">)</span>
<span class="co">#&gt; Current balance is: 100</span>
<span class="co">#&gt; And you are depositing:  20</span>

<span class="va">Pritesh</span>
<span class="co">#&gt; Dear Pritesh, your balance is: 120</span>

<span class="va">Pritesh</span><span class="op">$</span><span class="fu">withdraw</span><span class="op">(</span><span class="fl">150</span><span class="op">)</span>
<span class="co">#&gt; Current balance is: 120</span>
<span class="co">#&gt; And you are withdrawing: 150</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; You are trying to withdraw more that your balance.</span>
<span class="co">#&gt; I'm sorry, Pritesh, I'm afraid I can't do that.</span>
<span class="co">#&gt; Error:</span>

<span class="va">Pritesh</span>
<span class="co">#&gt; Dear Pritesh, your balance is: -30</span>

<span class="co"># make sure input validation checks work</span>
<span class="va">Pritesh</span><span class="op">$</span><span class="fu">deposit</span><span class="op">(</span><span class="op">-</span><span class="fl">20</span><span class="op">)</span>
<span class="co">#&gt; Error in self$validate(amount): amount &gt;= 0 is not TRUE</span>
<span class="va">Pritesh</span><span class="op">$</span><span class="fu">deposit</span><span class="op">(</span><span class="st">"pizza"</span><span class="op">)</span>
<span class="co">#&gt; Error in self$validate(amount): is.numeric(amount) is not TRUE</span>
<span class="va">Pritesh</span><span class="op">$</span><span class="fu">withdraw</span><span class="op">(</span><span class="op">-</span><span class="fl">54</span><span class="op">)</span>
<span class="co">#&gt; Error in self$validate(amount): amount &gt;= 0 is not TRUE</span>
<span class="va">Pritesh</span> <span class="op">&lt;-</span> <span class="va">bankAccountStrict</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Pritesh"</span>, balance <span class="op">=</span> <span class="op">-</span><span class="fl">45</span><span class="op">)</span>
<span class="co">#&gt; Error in self$validate(balance): amount &gt;= 0 is not TRUE</span></code></pre></div>
<p>Create a subclass that charges a fee if overdraw</p>
<div class="sourceCode" id="cb229"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bankAccountFee</span> <span class="op">&lt;-</span> <span class="fu">R6</span><span class="fu">::</span><span class="kw"><a href="https://r6.r-lib.org/reference/R6Class.html">R6Class</a></span><span class="op">(</span>
  <span class="st">"bankAccountFee"</span>,
  inherit <span class="op">=</span> <span class="va">bankAccount</span>,
  public <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    withdraw <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">amount</span><span class="op">)</span> <span class="op">{</span>
      <span class="co"># use method from superclass</span>
      <span class="va">super</span><span class="op">$</span><span class="fu">withdraw</span><span class="op">(</span><span class="va">amount</span><span class="op">)</span>

      <span class="kw">if</span> <span class="op">(</span><span class="va">self</span><span class="op">$</span><span class="va">balance</span> <span class="op">&lt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span>
        <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\nI am charging you 10 euros for overdrawing.\n"</span><span class="op">)</span>
        <span class="va">self</span><span class="op">$</span><span class="va">balance</span> <span class="op">&lt;-</span> <span class="va">self</span><span class="op">$</span><span class="va">balance</span> <span class="op">-</span> <span class="fl">10</span>
        <span class="fu"><a href="https://rdrr.io/r/base/invisible.html">invisible</a></span><span class="op">(</span><span class="va">self</span><span class="op">)</span>
      <span class="op">}</span>
    <span class="op">}</span>
  <span class="op">)</span>
<span class="op">)</span>

<span class="co"># create an instance of an object</span>
<span class="va">Mangesh</span> <span class="op">&lt;-</span> <span class="va">bankAccountFee</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Mangesh"</span>, balance <span class="op">=</span> <span class="fl">100</span><span class="op">)</span>

<span class="va">Mangesh</span>
<span class="co">#&gt; Dear Mangesh, your balance is: 100</span>

<span class="co"># do deposits and withdrawals to see if the balance changes</span>
<span class="va">Mangesh</span><span class="op">$</span><span class="fu">deposit</span><span class="op">(</span><span class="fl">20</span><span class="op">)</span>
<span class="co">#&gt; Current balance is: 100</span>
<span class="co">#&gt; And you are depositing:  20</span>

<span class="va">Mangesh</span>
<span class="co">#&gt; Dear Mangesh, your balance is: 120</span>

<span class="va">Mangesh</span><span class="op">$</span><span class="fu">withdraw</span><span class="op">(</span><span class="fl">150</span><span class="op">)</span>
<span class="co">#&gt; Current balance is: 120</span>
<span class="co">#&gt; And you are withdrawing: 150</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; I am charging you 10 euros for overdrawing.</span>

<span class="va">Mangesh</span>
<span class="co">#&gt; Dear Mangesh, your balance is: -40</span>

<span class="co"># make sure input validation checks work</span>
<span class="va">Mangesh</span><span class="op">$</span><span class="fu">deposit</span><span class="op">(</span><span class="op">-</span><span class="fl">20</span><span class="op">)</span>
<span class="co">#&gt; Error in self$validate(amount): amount &gt;= 0 is not TRUE</span>
<span class="va">Mangesh</span><span class="op">$</span><span class="fu">deposit</span><span class="op">(</span><span class="st">"pizza"</span><span class="op">)</span>
<span class="co">#&gt; Error in self$validate(amount): is.numeric(amount) is not TRUE</span>
<span class="va">Mangesh</span><span class="op">$</span><span class="fu">withdraw</span><span class="op">(</span><span class="op">-</span><span class="fl">54</span><span class="op">)</span>
<span class="co">#&gt; Error in self$validate(amount): amount &gt;= 0 is not TRUE</span>
<span class="va">Mangesh</span> <span class="op">&lt;-</span> <span class="va">bankAccountFee</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Mangesh"</span>, balance <span class="op">=</span> <span class="op">-</span><span class="fl">45</span><span class="op">)</span>
<span class="co">#&gt; Error in self$validate(balance): amount &gt;= 0 is not TRUE</span></code></pre></div>
<p><strong>Q2.</strong> Create an R6 class that represents a shuffled deck of cards. You should be able to draw cards from the deck with <code>$draw(n)</code>, and return all cards to the deck and reshuffle with <code>$reshuffle()</code>. Use the following code to make a vector of cards.</p>
<div class="sourceCode" id="cb230"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">suit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"♠"</span>, <span class="st">"♥"</span>, <span class="st">"♦"</span>, <span class="st">"♣"</span><span class="op">)</span>
<span class="va">value</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">10</span>, <span class="st">"J"</span>, <span class="st">"Q"</span>, <span class="st">"K"</span><span class="op">)</span>
<span class="va">cards</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="va">value</span>, <span class="fl">4</span><span class="op">)</span>, <span class="va">suit</span><span class="op">)</span></code></pre></div>
<p><strong>A2.</strong></p>
<div class="sourceCode" id="cb231"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">suit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"SPADE"</span>, <span class="st">"HEARTS"</span>, <span class="st">"DIAMOND"</span>, <span class="st">"CLUB"</span><span class="op">)</span> <span class="co"># sigh, Windows encoding issues</span>
<span class="va">value</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">10</span>, <span class="st">"J"</span>, <span class="st">"Q"</span>, <span class="st">"K"</span><span class="op">)</span>
<span class="va">cards</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="va">value</span>, <span class="fl">4</span><span class="op">)</span>, <span class="va">suit</span><span class="op">)</span>

<span class="va">deck</span> <span class="op">&lt;-</span> <span class="fu">R6</span><span class="fu">::</span><span class="kw"><a href="https://r6.r-lib.org/reference/R6Class.html">R6Class</a></span><span class="op">(</span>
  <span class="st">"deck"</span>,
  public <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    <span class="co"># fields -----------------------</span>

    <span class="co"># methods -----------------------</span>
    draw <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="op">{</span>
      <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="va">self</span><span class="op">$</span><span class="va">cards</span>, <span class="va">n</span><span class="op">)</span>
    <span class="op">}</span>,
    reshuffle <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span>
      <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="va">self</span><span class="op">$</span><span class="va">cards</span><span class="op">)</span>
      <span class="fu"><a href="https://rdrr.io/r/base/invisible.html">invisible</a></span><span class="op">(</span><span class="va">self</span><span class="op">)</span>
    <span class="op">}</span>,
    print <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span>
      <span class="st">"Drawn cards are:"</span>
      <span class="st">"Number of remaining cards:"</span>
    <span class="op">}</span>
  <span class="op">)</span>
<span class="op">)</span>

<span class="co"># create a new instance of this object</span>
<span class="va">mydeck</span> <span class="op">&lt;-</span> <span class="va">deck</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span>

<span class="co"># draw cards</span>
<span class="va">mydeck</span><span class="op">$</span><span class="fu">draw</span><span class="op">(</span><span class="fl">4</span><span class="op">)</span>

<span class="co"># reshuffle</span></code></pre></div>
<p><strong>Q3.</strong> Why can’t you model a bank account or a deck of cards with an S3 class?</p>
<p><strong>Q4.</strong> Create an R6 class that allows you to get and set the current time zone. You can access the current time zone with <code><a href="https://rdrr.io/r/base/timezones.html">Sys.timezone()</a></code> and set it with <code>Sys.setenv(TZ = "newtimezone")</code>. When setting the time zone, make sure the new time zone is in the list provided by <code><a href="https://rdrr.io/r/base/timezones.html">OlsonNames()</a></code>.</p>
<p><strong>Q5.</strong> Create an R6 class that manages the current working directory. It should have <code>$get()</code> and <code>$set()</code> methods.</p>
<p><strong>Q6.</strong> Why can’t you model the time zone or current working directory with an S3 class?</p>
<p><strong>Q7.</strong> What base type are R6 objects built on top of? What attributes do they have?</p>
</div>
<div id="exercise-14.3.3" class="section level2" number="14.2">
<h2>
<span class="header-section-number">14.2</span> Exercise 14.3.3<a class="anchor" aria-label="anchor" href="#exercise-14.3.3"><i class="fas fa-link"></i></a>
</h2>
<p><strong>Q1.</strong> Create a bank account class that prevents you from directly setting the account balance, but you can still withdraw from and deposit to. Throw an error if you attempt to go into overdraft.</p>
<p><strong>Q2.</strong> Create a class with a write-only <code>$password</code> field. It should have <code>$check_password(password)</code> method that returns <code>TRUE</code> or <code>FALSE</code>, but there should be no way to view the complete password.</p>
<p><strong>A2.</strong></p>
<div class="sourceCode" id="cb232"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r6.r-lib.org">R6</a></span><span class="op">)</span>

<span class="va">checkCredentials</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://r6.r-lib.org/reference/R6Class.html">R6Class</a></span><span class="op">(</span>
  <span class="st">"checkCredentials"</span>,
  public <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    <span class="co"># setter</span>
    set_password <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">password</span><span class="op">)</span> <span class="op">{</span>
      <span class="va">private</span><span class="op">$</span><span class="va">.password</span> <span class="op">&lt;-</span> <span class="va">password</span>
    <span class="op">}</span>,

    <span class="co"># checker</span>
    check_password <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">password</span><span class="op">)</span> <span class="op">{</span>
      <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">private</span><span class="op">$</span><span class="va">.password</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
        <span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="st">"No password set to check against."</span><span class="op">)</span>
      <span class="op">}</span>

      <span class="fu"><a href="https://rdrr.io/r/base/identical.html">identical</a></span><span class="op">(</span><span class="va">password</span>, <span class="va">private</span><span class="op">$</span><span class="va">.password</span><span class="op">)</span>
    <span class="op">}</span>,

    <span class="co"># the default print method prints the private fields as well</span>
    print <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span>
      <span class="st">"Password: XXXX"</span>

      <span class="co"># for method chaining</span>
      <span class="fu"><a href="https://rdrr.io/r/base/invisible.html">invisible</a></span><span class="op">(</span><span class="va">self</span><span class="op">)</span>
    <span class="op">}</span>
  <span class="op">)</span>,
  private <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    .password <span class="op">=</span> <span class="cn">NULL</span>
  <span class="op">)</span>
<span class="op">)</span>

<span class="va">myCheck</span> <span class="op">&lt;-</span> <span class="va">checkCredentials</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span>
<span class="va">myCheck</span>

<span class="va">myCheck</span><span class="op">$</span><span class="fu">set_password</span><span class="op">(</span><span class="st">"1234"</span><span class="op">)</span>

<span class="va">myCheck</span><span class="op">$</span><span class="fu">check_password</span><span class="op">(</span><span class="st">"abcd"</span><span class="op">)</span>
<span class="co">#&gt; [1] FALSE</span>
<span class="va">myCheck</span><span class="op">$</span><span class="fu">check_password</span><span class="op">(</span><span class="st">"1234"</span><span class="op">)</span>
<span class="co">#&gt; [1] TRUE</span></code></pre></div>
<p>But, of course, everything is possible:</p>
<div class="sourceCode" id="cb233"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">myCheck</span><span class="op">$</span><span class="va">.__enclos_env__</span><span class="op">$</span><span class="va">private</span><span class="op">$</span><span class="va">.password</span>
<span class="co">#&gt; [1] "1234"</span></code></pre></div>
<p><strong>Q3.</strong> Extend the <code>Rando</code> class with another active binding that allows you to access the previous random value. Ensure that active binding is the only way to access the value.</p>
<p><strong>Q4.</strong> Can subclasses access private fields/methods from their parent? Perform an experiment to find out.</p>
<p><strong>A4.</strong> Unlike classical OOP in other languages (e.g. C++), R6 subclasses also have access to the private methods in superclass (or base class).</p>
<p>For instance, in the following example, the <code>Duck</code> class has a private method <code>$quack()</code>, but its subclass <code>Mallard</code> can access it using <code>super$quack()</code>.</p>
<div class="sourceCode" id="cb234"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Duck</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://r6.r-lib.org/reference/R6Class.html">R6Class</a></span><span class="op">(</span><span class="st">"Duck"</span>,
  private <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>quack <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"Quack Quack"</span><span class="op">)</span><span class="op">)</span>
<span class="op">)</span>

<span class="va">Mallard</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://r6.r-lib.org/reference/R6Class.html">R6Class</a></span><span class="op">(</span><span class="st">"Mallard"</span>,
  inherit <span class="op">=</span> <span class="va">Duck</span>,
  public <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>quack <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="va">super</span><span class="op">$</span><span class="fu">quack</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="op">)</span>

<span class="va">myMallard</span> <span class="op">&lt;-</span> <span class="va">Mallard</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span>
<span class="va">myMallard</span><span class="op">$</span><span class="fu">quack</span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; [1] "Quack Quack"</span></code></pre></div>
</div>
<div id="exercise-14.4.4" class="section level2" number="14.3">
<h2>
<span class="header-section-number">14.3</span> Exercise 14.4.4<a class="anchor" aria-label="anchor" href="#exercise-14.4.4"><i class="fas fa-link"></i></a>
</h2>
<p><strong>Q1.</strong> Create a class that allows you to write a line to a specified file. You should open a connection to the file in <code>$initialize()</code>, append a line using <code><a href="https://rdrr.io/r/base/cat.html">cat()</a></code> in <code>$append_line()</code>, and close the connection in <code>$finalize()</code>.</p>
<div class="sourceCode" id="cb235"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r6.r-lib.org">R6</a></span><span class="op">)</span>

<span class="va">fileEditor</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://r6.r-lib.org/reference/R6Class.html">R6Class</a></span><span class="op">(</span>
  <span class="st">"fileEditor"</span>,
  public <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    initialize <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">filePath</span><span class="op">)</span> <span class="op">{</span>
      <span class="va">private</span><span class="op">$</span><span class="va">.connection</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/connections.html">file</a></span><span class="op">(</span><span class="va">filePath</span>, open <span class="op">=</span> <span class="st">"wt"</span><span class="op">)</span>
    <span class="op">}</span>,
    append_line <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">text</span><span class="op">)</span> <span class="op">{</span>
      <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span>
        <span class="va">text</span>,
        file <span class="op">=</span> <span class="va">private</span><span class="op">$</span><span class="va">.connection</span>,
        sep <span class="op">=</span> <span class="st">"\n"</span>,
        append <span class="op">=</span> <span class="cn">TRUE</span>
      <span class="op">)</span>
    <span class="op">}</span>
  <span class="op">)</span>,
  private <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    .connection <span class="op">=</span> <span class="cn">NULL</span>,
    <span class="co"># according to R6 docs, the destructor method should be private</span>
    finalize <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span>
      <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"Closing the file connection!"</span><span class="op">)</span>
      <span class="fu"><a href="https://rdrr.io/r/base/connections.html">close</a></span><span class="op">(</span><span class="va">private</span><span class="op">$</span><span class="va">.connection</span><span class="op">)</span>
    <span class="op">}</span>
  <span class="op">)</span>
<span class="op">)</span></code></pre></div>
<p>Let’s check if it works as expected:</p>
<div class="sourceCode" id="cb236"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">greetMom</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempfile</a></span><span class="op">(</span><span class="op">)</span>
  <span class="va">myfileEditor</span> <span class="op">&lt;-</span> <span class="va">fileEditor</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">f</span><span class="op">)</span>

  <span class="fu"><a href="https://rdrr.io/r/base/readLines.html">readLines</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span>

  <span class="va">myfileEditor</span><span class="op">$</span><span class="fu">append_line</span><span class="op">(</span><span class="st">"Hi mom!"</span><span class="op">)</span>
  <span class="va">myfileEditor</span><span class="op">$</span><span class="fu">append_line</span><span class="op">(</span><span class="st">"It's a beautiful day!"</span><span class="op">)</span>

  <span class="fu"><a href="https://rdrr.io/r/base/readLines.html">readLines</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span>
<span class="op">}</span>

<span class="fu">greetMom</span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; [1] "Hi mom!"               "It's a beautiful day!"</span>

<span class="co"># force garbage collection</span>
<span class="fu"><a href="https://rdrr.io/r/base/gc.html">gc</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; [1] "Closing the file connection!"</span>
<span class="co">#&gt;           used (Mb) gc trigger  (Mb) limit (Mb) max used</span>
<span class="co">#&gt; Ncells 1146547 61.3    2392847 127.8         NA  1837337</span>
<span class="co">#&gt; Vcells 1992208 15.2    8388608  64.0      16384  2982904</span>
<span class="co">#&gt;        (Mb)</span>
<span class="co">#&gt; Ncells 98.2</span>
<span class="co">#&gt; Vcells 22.8</span></code></pre></div>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="s3.html"><span class="header-section-number">13</span> S3</a></div>
<div class="next"><a href="s4.html"><span class="header-section-number">15</span> S4</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#r6"><span class="header-section-number">14</span> R6</a></li>
<li><a class="nav-link" href="#exercise-14.2.6"><span class="header-section-number">14.1</span> Exercise 14.2.6</a></li>
<li><a class="nav-link" href="#exercise-14.3.3"><span class="header-section-number">14.2</span> Exercise 14.3.3</a></li>
<li><a class="nav-link" href="#exercise-14.4.4"><span class="header-section-number">14.3</span> Exercise 14.4.4</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/IndrajeetPatil/Advanced-R-exercises/blob/master/R6.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/IndrajeetPatil/Advanced-R-exercises/edit/master/R6.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Advanced R Exercises</strong>" was written by Indrajeet Patil. It was last built on 2022-04-07.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
