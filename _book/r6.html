<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 14 R6 | Advanced R Exercises</title>
<meta name="author" content="Indrajeet Patil">
<meta name="description" content="14.1 Exercises 14.2.6 Q1. Create a bank account R6 class that stores a balance and allows you to deposit and withdraw money. Create a subclass that throws an error if you attempt to go into...">
<meta name="generator" content="bookdown 0.26 with bs4_book()">
<meta property="og:title" content="Chapter 14 R6 | Advanced R Exercises">
<meta property="og:type" content="book">
<meta property="og:image" content="/cover.png">
<meta property="og:description" content="14.1 Exercises 14.2.6 Q1. Create a bank account R6 class that stores a balance and allows you to deposit and withdraw money. Create a subclass that throws an error if you attempt to go into...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 14 R6 | Advanced R Exercises">
<meta name="twitter:description" content="14.1 Exercises 14.2.6 Q1. Create a bank account R6 class that stores a balance and allows you to deposit and withdraw money. Create a subclass that throws an error if you attempt to go into...">
<meta name="twitter:image" content="/cover.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.1/transition.js"></script><script src="libs/bs3compat-0.3.1/tabs.js"></script><script src="libs/bs3compat-0.3.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="bs4_style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Advanced R Exercises</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">About</a></li>
<li><a class="" href="introduction.html"><span class="header-section-number">1</span> Introduction</a></li>
<li><a class="" href="names-and-values.html"><span class="header-section-number">2</span> Names and values</a></li>
<li><a class="" href="vectors.html"><span class="header-section-number">3</span> Vectors</a></li>
<li><a class="" href="subsetting.html"><span class="header-section-number">4</span> Subsetting</a></li>
<li><a class="" href="control-flow.html"><span class="header-section-number">5</span> Control flow</a></li>
<li><a class="" href="functions.html"><span class="header-section-number">6</span> Functions</a></li>
<li><a class="" href="environments.html"><span class="header-section-number">7</span> Environments</a></li>
<li><a class="" href="conditions.html"><span class="header-section-number">8</span> Conditions</a></li>
<li><a class="" href="functionals.html"><span class="header-section-number">9</span> Functionals</a></li>
<li><a class="" href="function-factories.html"><span class="header-section-number">10</span> Function factories</a></li>
<li><a class="" href="function-operators.html"><span class="header-section-number">11</span> Function operators</a></li>
<li><a class="" href="base-types.html"><span class="header-section-number">12</span> Base Types</a></li>
<li><a class="" href="s3.html"><span class="header-section-number">13</span> S3</a></li>
<li><a class="active" href="r6.html"><span class="header-section-number">14</span> R6</a></li>
<li><a class="" href="s4.html"><span class="header-section-number">15</span> S4</a></li>
<li><a class="" href="trade-offs.html"><span class="header-section-number">16</span> Trade-offs</a></li>
<li><a class="" href="big-picture.html"><span class="header-section-number">17</span> Big Picture</a></li>
<li><a class="" href="expressions.html"><span class="header-section-number">18</span> Expressions</a></li>
<li><a class="" href="quotation.html"><span class="header-section-number">19</span> Quotation</a></li>
<li><a class="" href="evaluation.html"><span class="header-section-number">20</span> Evaluation</a></li>
<li><a class="" href="translation.html"><span class="header-section-number">21</span> Translation</a></li>
<li><a class="" href="debugging.html"><span class="header-section-number">22</span> Debugging</a></li>
<li><a class="" href="measuring-performance.html"><span class="header-section-number">23</span> Measuring performance</a></li>
<li><a class="" href="improving-performance.html"><span class="header-section-number">24</span> Improving performance</a></li>
<li><a class="" href="rewriting-r-code-in-c.html"><span class="header-section-number">25</span> Rewriting R code in C++</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/IndrajeetPatil/Advanced-R-exercises">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="r6" class="section level1" number="14">
<h1>
<span class="header-section-number">14</span> R6<a class="anchor" aria-label="anchor" href="#r6"><i class="fas fa-link"></i></a>
</h1>
<div id="exercises-14.2.6" class="section level2" number="14.1">
<h2>
<span class="header-section-number">14.1</span> Exercises 14.2.6<a class="anchor" aria-label="anchor" href="#exercises-14.2.6"><i class="fas fa-link"></i></a>
</h2>
<p><strong>Q1.</strong> Create a bank account R6 class that stores a balance and allows you to deposit and withdraw money. Create a subclass that throws an error if you attempt to go into overdraft. Create another subclass that allows you to go into overdraft, but charges you a fee. Create the superclass and make sure it works as expected.</p>
<p><strong>A1.</strong> First, let’s create a bank account R6 class that stores a balance and allows you to deposit and withdraw money:</p>
<div class="sourceCode" id="cb327"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r6.r-lib.org">R6</a></span><span class="op">)</span>

<span class="va">bankAccount</span> <span class="op">&lt;-</span> <span class="fu">R6</span><span class="fu">::</span><span class="kw"><a href="https://rdrr.io/pkg/R6/man/R6Class.html">R6Class</a></span><span class="op">(</span>
  <span class="st">"bankAccount"</span>,
  public <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    balance <span class="op">=</span> <span class="fl">0</span>,
    initialize <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">balance</span><span class="op">)</span> <span class="op">{</span>
      <span class="va">self</span><span class="op">$</span><span class="va">balance</span> <span class="op">&lt;-</span> <span class="va">balance</span>
    <span class="op">}</span>,
    deposit <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">amount</span><span class="op">)</span> <span class="op">{</span>
      <span class="va">self</span><span class="op">$</span><span class="va">balance</span> <span class="op">&lt;-</span> <span class="va">self</span><span class="op">$</span><span class="va">balance</span> <span class="op">+</span> <span class="va">amount</span>
      <span class="fu"><a href="https://rdrr.io/r/base/message.html">message</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"Current balance is: "</span>, <span class="va">self</span><span class="op">$</span><span class="va">balance</span><span class="op">)</span><span class="op">)</span>
      <span class="fu"><a href="https://rdrr.io/r/base/invisible.html">invisible</a></span><span class="op">(</span><span class="va">self</span><span class="op">)</span>
    <span class="op">}</span>,
    withdraw <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">amount</span><span class="op">)</span> <span class="op">{</span>
      <span class="va">self</span><span class="op">$</span><span class="va">balance</span> <span class="op">&lt;-</span> <span class="va">self</span><span class="op">$</span><span class="va">balance</span> <span class="op">-</span> <span class="va">amount</span>
      <span class="fu"><a href="https://rdrr.io/r/base/message.html">message</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"Current balance is: "</span>, <span class="va">self</span><span class="op">$</span><span class="va">balance</span><span class="op">)</span><span class="op">)</span>
      <span class="fu"><a href="https://rdrr.io/r/base/invisible.html">invisible</a></span><span class="op">(</span><span class="va">self</span><span class="op">)</span>
    <span class="op">}</span>
  <span class="op">)</span>
<span class="op">)</span></code></pre></div>
<p>Let’s try it out:</p>
<div class="sourceCode" id="cb328"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">indra</span> <span class="op">&lt;-</span> <span class="va">bankAccount</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>balance <span class="op">=</span> <span class="fl">100</span><span class="op">)</span>

<span class="va">indra</span><span class="op">$</span><span class="fu">deposit</span><span class="op">(</span><span class="fl">20</span><span class="op">)</span>
<span class="co">#&gt; Current balance is: 120</span>

<span class="va">indra</span><span class="op">$</span><span class="fu">withdraw</span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>
<span class="co">#&gt; Current balance is: 110</span></code></pre></div>
<p>Create a subclass that errors if you attempt to overdraw:</p>
<div class="sourceCode" id="cb329"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bankAccountStrict</span> <span class="op">&lt;-</span> <span class="fu">R6</span><span class="fu">::</span><span class="kw"><a href="https://rdrr.io/pkg/R6/man/R6Class.html">R6Class</a></span><span class="op">(</span>
  <span class="st">"bankAccountStrict"</span>,
  inherit <span class="op">=</span> <span class="va">bankAccount</span>,
  public <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    withdraw <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">amount</span><span class="op">)</span> <span class="op">{</span>
      <span class="kw">if</span> <span class="op">(</span><span class="va">self</span><span class="op">$</span><span class="va">balance</span> <span class="op">-</span> <span class="va">amount</span> <span class="op">&lt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span>
        <span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span>
          <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"Can't withdraw more than your current balance: "</span>, <span class="va">self</span><span class="op">$</span><span class="va">balance</span><span class="op">)</span>,
          call. <span class="op">=</span> <span class="cn">FALSE</span>
        <span class="op">)</span>
      <span class="op">}</span>

      <span class="va">super</span><span class="op">$</span><span class="fu">withdraw</span><span class="op">(</span><span class="va">amount</span><span class="op">)</span>
    <span class="op">}</span>
  <span class="op">)</span>
<span class="op">)</span></code></pre></div>
<p>Let’s try it out:</p>
<div class="sourceCode" id="cb330"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Pritesh</span> <span class="op">&lt;-</span> <span class="va">bankAccountStrict</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>balance <span class="op">=</span> <span class="fl">100</span><span class="op">)</span>

<span class="va">Pritesh</span><span class="op">$</span><span class="fu">deposit</span><span class="op">(</span><span class="fl">20</span><span class="op">)</span>
<span class="co">#&gt; Current balance is: 120</span>

<span class="va">Pritesh</span><span class="op">$</span><span class="fu">withdraw</span><span class="op">(</span><span class="fl">150</span><span class="op">)</span>
<span class="co">#&gt; Error: Can't withdraw more than your current balance: 120</span></code></pre></div>
<p>Now let’s create a subclass that charges a fee if account is overdrawn:</p>
<div class="sourceCode" id="cb331"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bankAccountFee</span> <span class="op">&lt;-</span> <span class="fu">R6</span><span class="fu">::</span><span class="kw"><a href="https://rdrr.io/pkg/R6/man/R6Class.html">R6Class</a></span><span class="op">(</span>
  <span class="st">"bankAccountFee"</span>,
  inherit <span class="op">=</span> <span class="va">bankAccount</span>,
  public <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    withdraw <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">amount</span><span class="op">)</span> <span class="op">{</span>
      <span class="va">super</span><span class="op">$</span><span class="fu">withdraw</span><span class="op">(</span><span class="va">amount</span><span class="op">)</span>

      <span class="kw">if</span> <span class="op">(</span><span class="va">self</span><span class="op">$</span><span class="va">balance</span><span class="op">)</span> <span class="op">{</span>
        <span class="va">self</span><span class="op">$</span><span class="va">balance</span> <span class="op">&lt;-</span> <span class="va">self</span><span class="op">$</span><span class="va">balance</span> <span class="op">-</span> <span class="fl">10</span>
        <span class="fu"><a href="https://rdrr.io/r/base/message.html">message</a></span><span class="op">(</span><span class="st">"You're withdrawing more than your current balance. You will be charged a fee of 10 euros."</span><span class="op">)</span>
      <span class="op">}</span>
    <span class="op">}</span>
  <span class="op">)</span>
<span class="op">)</span></code></pre></div>
<p>Let’s try it out:</p>
<div class="sourceCode" id="cb332"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Mangesh</span> <span class="op">&lt;-</span> <span class="va">bankAccountFee</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>balance <span class="op">=</span> <span class="fl">100</span><span class="op">)</span>

<span class="va">Mangesh</span><span class="op">$</span><span class="fu">deposit</span><span class="op">(</span><span class="fl">20</span><span class="op">)</span>
<span class="co">#&gt; Current balance is: 120</span>

<span class="va">Mangesh</span><span class="op">$</span><span class="fu">withdraw</span><span class="op">(</span><span class="fl">150</span><span class="op">)</span>
<span class="co">#&gt; Current balance is: -30</span>
<span class="co">#&gt; You're withdrawing more than your current balance. You will be charged a fee of 10 euros.</span></code></pre></div>
<p><strong>Q2.</strong> Create an R6 class that represents a shuffled deck of cards. You should be able to draw cards from the deck with <code>$draw(n)</code>, and return all cards to the deck and reshuffle with <code>$reshuffle()</code>. Use the following code to make a vector of cards.</p>
<div class="sourceCode" id="cb333"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">suit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"♠"</span>, <span class="st">"♥"</span>, <span class="st">"♦"</span>, <span class="st">"♣"</span><span class="op">)</span>
<span class="va">value</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">10</span>, <span class="st">"J"</span>, <span class="st">"Q"</span>, <span class="st">"K"</span><span class="op">)</span>
<span class="va">cards</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="va">value</span>, <span class="fl">4</span><span class="op">)</span>, <span class="va">suit</span><span class="op">)</span></code></pre></div>
<p><strong>A2.</strong> Let’s create needed class that represents a shuffled deck of cards:</p>
<div class="sourceCode" id="cb334"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">suit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"♠"</span>, <span class="st">"♥"</span>, <span class="st">"♦"</span>, <span class="st">"♣"</span><span class="op">)</span>
<span class="va">value</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">10</span>, <span class="st">"J"</span>, <span class="st">"Q"</span>, <span class="st">"K"</span><span class="op">)</span>
<span class="va">cards</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="va">value</span>, <span class="fl">4</span><span class="op">)</span>, <span class="va">suit</span><span class="op">)</span>

<span class="va">Deck</span> <span class="op">&lt;-</span> <span class="fu">R6</span><span class="fu">::</span><span class="kw"><a href="https://rdrr.io/pkg/R6/man/R6Class.html">R6Class</a></span><span class="op">(</span>
  <span class="st">"Deck"</span>,
  public <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    initialize <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">deck</span><span class="op">)</span> <span class="op">{</span>
      <span class="va">private</span><span class="op">$</span><span class="va">cards</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="va">deck</span><span class="op">)</span>
    <span class="op">}</span>,
    draw <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="op">{</span>
      <span class="kw">if</span> <span class="op">(</span><span class="va">n</span> <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">private</span><span class="op">$</span><span class="va">cards</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
        <span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span>
          <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"Can't draw more than remaining number of cards: "</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">private</span><span class="op">$</span><span class="va">cards</span><span class="op">)</span><span class="op">)</span>,
          call. <span class="op">=</span> <span class="cn">FALSE</span>
        <span class="op">)</span>
      <span class="op">}</span>

      <span class="va">drawn_cards</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="va">private</span><span class="op">$</span><span class="va">cards</span>, <span class="va">n</span><span class="op">)</span>
      <span class="va">private</span><span class="op">$</span><span class="va">cards</span> <span class="op">&lt;-</span> <span class="va">private</span><span class="op">$</span><span class="va">cards</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">private</span><span class="op">$</span><span class="va">cards</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">drawn_cards</span><span class="op">)</span><span class="op">]</span>
      <span class="fu"><a href="https://rdrr.io/r/base/message.html">message</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"Remaining number of cards: "</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">private</span><span class="op">$</span><span class="va">cards</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

      <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">drawn_cards</span><span class="op">)</span>
    <span class="op">}</span>,
    reshuffle <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span>
      <span class="va">private</span><span class="op">$</span><span class="va">cards</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="va">private</span><span class="op">$</span><span class="va">cards</span><span class="op">)</span>
      <span class="fu"><a href="https://rdrr.io/r/base/invisible.html">invisible</a></span><span class="op">(</span><span class="va">self</span><span class="op">)</span>
    <span class="op">}</span>
  <span class="op">)</span>,
  private <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    cards <span class="op">=</span> <span class="cn">NULL</span>
  <span class="op">)</span>
<span class="op">)</span></code></pre></div>
<p>Let’s try it out:</p>
<div class="sourceCode" id="cb335"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">myDeck</span> <span class="op">&lt;-</span> <span class="va">Deck</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">cards</span><span class="op">)</span>

<span class="va">myDeck</span><span class="op">$</span><span class="fu">draw</span><span class="op">(</span><span class="fl">4</span><span class="op">)</span>
<span class="co">#&gt; Remaining number of cards: 48</span>
<span class="co">#&gt; [1] "2 ♠"  "10 ♦" "9 ♦"  "3 ♦"</span>

<span class="va">myDeck</span><span class="op">$</span><span class="fu">reshuffle</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="fu">draw</span><span class="op">(</span><span class="fl">5</span><span class="op">)</span>
<span class="co">#&gt; Remaining number of cards: 43</span>
<span class="co">#&gt; [1] "6 ♦"  "10 ♥" "2 ♥"  "A ♥"  "8 ♥"</span>

<span class="va">myDeck</span><span class="op">$</span><span class="fu">draw</span><span class="op">(</span><span class="fl">50</span><span class="op">)</span>
<span class="co">#&gt; Error: Can't draw more than remaining number of cards: 43</span></code></pre></div>
<p><strong>Q3.</strong> Why can’t you model a bank account or a deck of cards with an S3 class?</p>
<p><strong>A3.</strong> We can’t model a bank account or a deck of cards with an S3 class because instances of these classes are not <em>mutable</em>. On the other hand, R6 classes encapsulate data and represent its <em>state</em>, which can change over the course of object’s lifecycle.</p>
<p><strong>Q4.</strong> Create an R6 class that allows you to get and set the current time zone. You can access the current time zone with <code><a href="https://rdrr.io/r/base/timezones.html">Sys.timezone()</a></code> and set it with <code>Sys.setenv(TZ = "newtimezone")</code>. When setting the time zone, make sure the new time zone is in the list provided by <code><a href="https://rdrr.io/r/base/timezones.html">OlsonNames()</a></code>.</p>
<p><strong>A4.</strong> Here is an R6 class that manages the current time zone:</p>
<div class="sourceCode" id="cb336"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">CurrentTimeZone</span> <span class="op">&lt;-</span> <span class="fu">R6</span><span class="fu">::</span><span class="kw"><a href="https://rdrr.io/pkg/R6/man/R6Class.html">R6Class</a></span><span class="op">(</span><span class="st">"CurrentTimeZone"</span>,
  public <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    setTimeZone <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">tz</span><span class="op">)</span> <span class="op">{</span>
      <span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html">stopifnot</a></span><span class="op">(</span><span class="va">tz</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/timezones.html">OlsonNames</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
      <span class="fu"><a href="https://rdrr.io/r/base/Sys.setenv.html">Sys.setenv</a></span><span class="op">(</span>TZ <span class="op">=</span> <span class="va">tz</span><span class="op">)</span>
    <span class="op">}</span>,
    getTimeZone <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span>
      <span class="fu"><a href="https://rdrr.io/r/base/timezones.html">Sys.timezone</a></span><span class="op">(</span><span class="op">)</span>
    <span class="op">}</span>
  <span class="op">)</span>
<span class="op">)</span></code></pre></div>
<p>Let’s try it out:</p>
<div class="sourceCode" id="cb337"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">myCurrentTimeZone</span> <span class="op">&lt;-</span> <span class="va">CurrentTimeZone</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span>

<span class="va">myCurrentTimeZone</span><span class="op">$</span><span class="fu">getTimeZone</span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; [1] "Europe/Berlin"</span>

<span class="va">myCurrentTimeZone</span><span class="op">$</span><span class="fu">setTimeZone</span><span class="op">(</span><span class="st">"Asia/Kolkata"</span><span class="op">)</span>
<span class="va">myCurrentTimeZone</span><span class="op">$</span><span class="fu">getTimeZone</span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; [1] "Europe/Berlin"</span>

<span class="va">myCurrentTimeZone</span><span class="op">$</span><span class="fu">setTimeZone</span><span class="op">(</span><span class="st">"Europe/Berlin"</span><span class="op">)</span></code></pre></div>
<p><strong>Q5.</strong> Create an R6 class that manages the current working directory. It should have <code>$get()</code> and <code>$set()</code> methods.</p>
<p><strong>A5.</strong> Here is an R6 class that manages the current working directory:</p>
<div class="sourceCode" id="cb338"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ManageDirectory</span> <span class="op">&lt;-</span> <span class="fu">R6</span><span class="fu">::</span><span class="kw"><a href="https://rdrr.io/pkg/R6/man/R6Class.html">R6Class</a></span><span class="op">(</span><span class="st">"ManageDirectory"</span>,
  public <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    setWorkingDirectory <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">dir</span><span class="op">)</span> <span class="op">{</span>
      <span class="fu"><a href="https://rdrr.io/r/base/getwd.html">setwd</a></span><span class="op">(</span><span class="va">dir</span><span class="op">)</span>
    <span class="op">}</span>,
    getWorkingDirectory <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span>
      <span class="fu"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span><span class="op">(</span><span class="op">)</span>
    <span class="op">}</span>
  <span class="op">)</span>
<span class="op">)</span></code></pre></div>
<p>Let’s create an instance of this class and check if the methods work as expected:</p>
<div class="sourceCode" id="cb339"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">myDirManager</span> <span class="op">&lt;-</span> <span class="va">ManageDirectory</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span>

<span class="co"># current working directory</span>
<span class="va">myDirManager</span><span class="op">$</span><span class="fu">getWorkingDirectory</span><span class="op">(</span><span class="op">)</span>

<span class="co"># change and check if that worked</span>
<span class="va">myDirManager</span><span class="op">$</span><span class="fu">setWorkingDirectory</span><span class="op">(</span><span class="st">".."</span><span class="op">)</span>
<span class="va">myDirManager</span><span class="op">$</span><span class="fu">getWorkingDirectory</span><span class="op">(</span><span class="op">)</span>

<span class="co"># revert this change</span>
<span class="va">myDirManager</span><span class="op">$</span><span class="fu">setWorkingDirectory</span><span class="op">(</span><span class="st">"/Advanced-R-exercises"</span><span class="op">)</span></code></pre></div>
<p><strong>Q6.</strong> Why can’t you model the time zone or current working directory with an S3 class?</p>
<p><strong>A6.</strong> Same as answer to <strong>Q3</strong>:</p>
<p>We can’t model a bank account or a deck of cards with an S3 class because instances of these classes are not <em>mutable</em>. On the other hand, R6 classes encapsulate data and represent its <em>state</em>, which can change over the course of object’s lifecycle.</p>
<p><strong>Q7.</strong> What base type are R6 objects built on top of? What attributes do they have?</p>
<p><strong>A7.</strong> Let’s create an example class and create instance of that class:</p>
<div class="sourceCode" id="cb340"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Example</span> <span class="op">&lt;-</span> <span class="fu">R6</span><span class="fu">::</span><span class="kw"><a href="https://rdrr.io/pkg/R6/man/R6Class.html">R6Class</a></span><span class="op">(</span><span class="st">"Example"</span><span class="op">)</span>
<span class="va">myExample</span> <span class="op">&lt;-</span> <span class="va">Example</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>The <code>R6</code> objects are built on top of environment:</p>
<div class="sourceCode" id="cb341"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/typeof.html">typeof</a></span><span class="op">(</span><span class="va">myExample</span><span class="op">)</span>
<span class="co">#&gt; [1] "environment"</span>

<span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rlang/man/env_print.html">env_print</a></span><span class="op">(</span><span class="va">myExample</span><span class="op">)</span>
<span class="co">#&gt; &lt;environment: 0x104fbbeb0&gt; [L]</span>
<span class="co">#&gt; Parent: &lt;environment: empty&gt;</span>
<span class="co">#&gt; Class: Example, R6</span>
<span class="co">#&gt; Bindings:</span>
<span class="co">#&gt; • .__enclos_env__: &lt;env&gt;</span>
<span class="co">#&gt; • clone: &lt;fn&gt; [L]</span></code></pre></div>
<p>And it has only <code>class</code> attribute, which is a character vector with the <code>"R6"</code> being the last element and the superclasses being other elements:</p>
<div class="sourceCode" id="cb342"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/attributes.html">attributes</a></span><span class="op">(</span><span class="va">myExample</span><span class="op">)</span>
<span class="co">#&gt; $class</span>
<span class="co">#&gt; [1] "Example" "R6"</span></code></pre></div>
</div>
<div id="exercises-14.3.3" class="section level2" number="14.2">
<h2>
<span class="header-section-number">14.2</span> Exercises 14.3.3<a class="anchor" aria-label="anchor" href="#exercises-14.3.3"><i class="fas fa-link"></i></a>
</h2>
<p><strong>Q1.</strong> Create a bank account class that prevents you from directly setting the account balance, but you can still withdraw from and deposit to. Throw an error if you attempt to go into overdraft.</p>
<p><strong>A1.</strong> Here is a bank account class that satisfied the specified requirements:</p>
<div class="sourceCode" id="cb343"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SafeBankAccount</span> <span class="op">&lt;-</span> <span class="fu">R6</span><span class="fu">::</span><span class="kw"><a href="https://rdrr.io/pkg/R6/man/R6Class.html">R6Class</a></span><span class="op">(</span>
  classname <span class="op">=</span> <span class="st">"SafeBankAccount"</span>,
  public <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    deposit <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">deposit_amount</span><span class="op">)</span> <span class="op">{</span>
      <span class="va">private</span><span class="op">$</span><span class="va">.balance</span> <span class="op">&lt;-</span> <span class="va">private</span><span class="op">$</span><span class="va">.balance</span> <span class="op">+</span> <span class="va">deposit_amount</span>
      <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Current balance:"</span>, <span class="va">private</span><span class="op">$</span><span class="va">.balance</span><span class="op">)</span><span class="op">)</span>

      <span class="fu"><a href="https://rdrr.io/r/base/invisible.html">invisible</a></span><span class="op">(</span><span class="va">self</span><span class="op">)</span>
    <span class="op">}</span>,
    withdraw <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">withdrawal_amount</span><span class="op">)</span> <span class="op">{</span>
      <span class="kw">if</span> <span class="op">(</span><span class="va">withdrawal_amount</span> <span class="op">&gt;</span> <span class="va">private</span><span class="op">$</span><span class="va">.balance</span><span class="op">)</span> <span class="op">{</span>
        <span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="st">"You can't withdraw more than your current balance."</span>, call. <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
      <span class="op">}</span>

      <span class="va">private</span><span class="op">$</span><span class="va">.balance</span> <span class="op">&lt;-</span> <span class="va">private</span><span class="op">$</span><span class="va">.balance</span> <span class="op">-</span> <span class="va">withdrawal_amount</span>
      <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Current balance:"</span>, <span class="va">private</span><span class="op">$</span><span class="va">.balance</span><span class="op">)</span><span class="op">)</span>

      <span class="fu"><a href="https://rdrr.io/r/base/invisible.html">invisible</a></span><span class="op">(</span><span class="va">self</span><span class="op">)</span>
    <span class="op">}</span>
  <span class="op">)</span>,
  private <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    .balance <span class="op">=</span> <span class="fl">0</span>
  <span class="op">)</span>
<span class="op">)</span></code></pre></div>
<p>Let’s check if it works as expected:</p>
<div class="sourceCode" id="cb344"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mySafeBankAccount</span> <span class="op">&lt;-</span> <span class="va">SafeBankAccount</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span>

<span class="va">mySafeBankAccount</span><span class="op">$</span><span class="fu">deposit</span><span class="op">(</span><span class="fl">100</span><span class="op">)</span>
<span class="co">#&gt; [1] "Current balance: 100"</span>

<span class="va">mySafeBankAccount</span><span class="op">$</span><span class="fu">withdraw</span><span class="op">(</span><span class="fl">50</span><span class="op">)</span>
<span class="co">#&gt; [1] "Current balance: 50"</span>

<span class="va">mySafeBankAccount</span><span class="op">$</span><span class="fu">withdraw</span><span class="op">(</span><span class="fl">100</span><span class="op">)</span>
<span class="co">#&gt; Error: You can't withdraw more than your current balance.</span></code></pre></div>
<p><strong>Q2.</strong> Create a class with a write-only <code>$password</code> field. It should have <code>$check_password(password)</code> method that returns <code>TRUE</code> or <code>FALSE</code>, but there should be no way to view the complete password.</p>
<p><strong>A2.</strong> Here is an implementation of the class with the needed properties:</p>
<div class="sourceCode" id="cb345"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r6.r-lib.org">R6</a></span><span class="op">)</span>

<span class="va">checkCredentials</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/pkg/R6/man/R6Class.html">R6Class</a></span><span class="op">(</span>
  <span class="st">"checkCredentials"</span>,
  public <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    <span class="co"># setter</span>
    set_password <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">password</span><span class="op">)</span> <span class="op">{</span>
      <span class="va">private</span><span class="op">$</span><span class="va">.password</span> <span class="op">&lt;-</span> <span class="va">password</span>
    <span class="op">}</span>,

    <span class="co"># checker</span>
    check_password <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">password</span><span class="op">)</span> <span class="op">{</span>
      <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">private</span><span class="op">$</span><span class="va">.password</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
        <span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="st">"No password set to check against."</span><span class="op">)</span>
      <span class="op">}</span>

      <span class="fu"><a href="https://rdrr.io/r/base/identical.html">identical</a></span><span class="op">(</span><span class="va">password</span>, <span class="va">private</span><span class="op">$</span><span class="va">.password</span><span class="op">)</span>
    <span class="op">}</span>,

    <span class="co"># the default print method prints the private fields as well</span>
    print <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span>
      <span class="st">"Password: XXXX"</span>

      <span class="co"># for method chaining</span>
      <span class="fu"><a href="https://rdrr.io/r/base/invisible.html">invisible</a></span><span class="op">(</span><span class="va">self</span><span class="op">)</span>
    <span class="op">}</span>
  <span class="op">)</span>,
  private <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    .password <span class="op">=</span> <span class="cn">NULL</span>
  <span class="op">)</span>
<span class="op">)</span>

<span class="va">myCheck</span> <span class="op">&lt;-</span> <span class="va">checkCredentials</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span>
<span class="va">myCheck</span>

<span class="va">myCheck</span><span class="op">$</span><span class="fu">set_password</span><span class="op">(</span><span class="st">"1234"</span><span class="op">)</span>

<span class="va">myCheck</span><span class="op">$</span><span class="fu">check_password</span><span class="op">(</span><span class="st">"abcd"</span><span class="op">)</span>
<span class="co">#&gt; [1] FALSE</span>
<span class="va">myCheck</span><span class="op">$</span><span class="fu">check_password</span><span class="op">(</span><span class="st">"1234"</span><span class="op">)</span>
<span class="co">#&gt; [1] TRUE</span></code></pre></div>
<p>But, of course, everything is possible:</p>
<div class="sourceCode" id="cb346"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">myCheck</span><span class="op">$</span><span class="va">.__enclos_env__</span><span class="op">$</span><span class="va">private</span><span class="op">$</span><span class="va">.password</span>
<span class="co">#&gt; [1] "1234"</span></code></pre></div>
<p><strong>Q3.</strong> Extend the <code>Rando</code> class with another active binding that allows you to access the previous random value. Ensure that active binding is the only way to access the value.</p>
<p><strong>A3.</strong> Here is a modified version of the <code>Rando</code> class to meet the specified requirements:</p>
<div class="sourceCode" id="cb347"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Rando</span> <span class="op">&lt;-</span> <span class="fu">R6</span><span class="fu">::</span><span class="kw"><a href="https://rdrr.io/pkg/R6/man/R6Class.html">R6Class</a></span><span class="op">(</span><span class="st">"Rando"</span>,
  active <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    random <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">value</span><span class="op">)</span> <span class="op">{</span>
      <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/rlang/man/missing.html">missing</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
        <span class="va">newValue</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>
        <span class="va">private</span><span class="op">$</span><span class="va">.previousRandom</span> <span class="op">&lt;-</span> <span class="va">private</span><span class="op">$</span><span class="va">.currentRandom</span>
        <span class="va">private</span><span class="op">$</span><span class="va">.currentRandom</span> <span class="op">&lt;-</span> <span class="va">newValue</span>
        <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">private</span><span class="op">$</span><span class="va">.currentRandom</span><span class="op">)</span>
      <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span>
        <span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="st">"Can't set `$random`"</span>, call. <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
      <span class="op">}</span>
    <span class="op">}</span>,
    previousRandom <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">value</span><span class="op">)</span> <span class="op">{</span>
      <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/rlang/man/missing.html">missing</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
        <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">private</span><span class="op">$</span><span class="va">.previousRandom</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
          <span class="fu"><a href="https://rdrr.io/r/base/message.html">message</a></span><span class="op">(</span><span class="st">"No random value has been generated yet."</span><span class="op">)</span>
        <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span>
          <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">private</span><span class="op">$</span><span class="va">.previousRandom</span><span class="op">)</span>
        <span class="op">}</span>
      <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span>
        <span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="st">"Can't set `$previousRandom`"</span>, call. <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
      <span class="op">}</span>
    <span class="op">}</span>
  <span class="op">)</span>,
  private <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    .currentRandom <span class="op">=</span> <span class="cn">NULL</span>,
    .previousRandom <span class="op">=</span> <span class="cn">NULL</span>
  <span class="op">)</span>
<span class="op">)</span></code></pre></div>
<p>Let’s try it out:</p>
<div class="sourceCode" id="cb348"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">myRando</span> <span class="op">&lt;-</span> <span class="va">Rando</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span>

<span class="co"># first time</span>
<span class="va">myRando</span><span class="op">$</span><span class="va">random</span>
<span class="co">#&gt; [1] 0.5549124</span>
<span class="va">myRando</span><span class="op">$</span><span class="va">previousRandom</span>
<span class="co">#&gt; No random value has been generated yet.</span>
<span class="co">#&gt; NULL</span>

<span class="co"># second time</span>
<span class="va">myRando</span><span class="op">$</span><span class="va">random</span>
<span class="co">#&gt; [1] 0.3482785</span>
<span class="va">myRando</span><span class="op">$</span><span class="va">previousRandom</span>
<span class="co">#&gt; [1] 0.5549124</span>

<span class="co"># third time</span>
<span class="va">myRando</span><span class="op">$</span><span class="va">random</span>
<span class="co">#&gt; [1] 0.2187275</span>
<span class="va">myRando</span><span class="op">$</span><span class="va">previousRandom</span>
<span class="co">#&gt; [1] 0.3482785</span></code></pre></div>
<p><strong>Q4.</strong> Can subclasses access private fields/methods from their parent? Perform an experiment to find out.</p>
<p><strong>A4.</strong> Unlike common OOP in other languages (e.g. C++), R6 subclasses (or derived classes) also have access to the private methods in superclass (or base class).</p>
<p>For instance, in the following example, the <code>Duck</code> class has a private method <code>$quack()</code>, but its subclass <code>Mallard</code> can access it using <code>super$quack()</code>.</p>
<div class="sourceCode" id="cb349"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Duck</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/pkg/R6/man/R6Class.html">R6Class</a></span><span class="op">(</span><span class="st">"Duck"</span>,
  private <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>quack <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"Quack Quack"</span><span class="op">)</span><span class="op">)</span>
<span class="op">)</span>

<span class="va">Mallard</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/pkg/R6/man/R6Class.html">R6Class</a></span><span class="op">(</span><span class="st">"Mallard"</span>,
  inherit <span class="op">=</span> <span class="va">Duck</span>,
  public <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>quack <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="va">super</span><span class="op">$</span><span class="fu">quack</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="op">)</span>

<span class="va">myMallard</span> <span class="op">&lt;-</span> <span class="va">Mallard</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span>
<span class="va">myMallard</span><span class="op">$</span><span class="fu">quack</span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; [1] "Quack Quack"</span></code></pre></div>
</div>
<div id="exercises-14.4.4" class="section level2" number="14.3">
<h2>
<span class="header-section-number">14.3</span> Exercises 14.4.4<a class="anchor" aria-label="anchor" href="#exercises-14.4.4"><i class="fas fa-link"></i></a>
</h2>
<p><strong>Q1.</strong> Create a class that allows you to write a line to a specified file. You should open a connection to the file in <code>$initialize()</code>, append a line using <code><a href="https://rdrr.io/r/base/cat.html">cat()</a></code> in <code>$append_line()</code>, and close the connection in <code>$finalize()</code>.</p>
<p><strong>A1.</strong> Here is a class that allows you to write a line to a specified file:</p>
<div class="sourceCode" id="cb350"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r6.r-lib.org">R6</a></span><span class="op">)</span>

<span class="va">fileEditor</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/pkg/R6/man/R6Class.html">R6Class</a></span><span class="op">(</span>
  <span class="st">"fileEditor"</span>,
  public <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    initialize <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">filePath</span><span class="op">)</span> <span class="op">{</span>
      <span class="va">private</span><span class="op">$</span><span class="va">.connection</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/connections.html">file</a></span><span class="op">(</span><span class="va">filePath</span>, open <span class="op">=</span> <span class="st">"wt"</span><span class="op">)</span>
    <span class="op">}</span>,
    append_line <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">text</span><span class="op">)</span> <span class="op">{</span>
      <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span>
        <span class="va">text</span>,
        file <span class="op">=</span> <span class="va">private</span><span class="op">$</span><span class="va">.connection</span>,
        sep <span class="op">=</span> <span class="st">"\n"</span>,
        append <span class="op">=</span> <span class="cn">TRUE</span>
      <span class="op">)</span>
    <span class="op">}</span>
  <span class="op">)</span>,
  private <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    .connection <span class="op">=</span> <span class="cn">NULL</span>,
    <span class="co"># according to R6 docs, the destructor method should be private</span>
    finalize <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span>
      <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"Closing the file connection!"</span><span class="op">)</span>
      <span class="fu"><a href="https://rdrr.io/r/base/connections.html">close</a></span><span class="op">(</span><span class="va">private</span><span class="op">$</span><span class="va">.connection</span><span class="op">)</span>
    <span class="op">}</span>
  <span class="op">)</span>
<span class="op">)</span></code></pre></div>
<p>Let’s check if it works as expected:</p>
<div class="sourceCode" id="cb351"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">greetMom</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempfile</a></span><span class="op">(</span><span class="op">)</span>
  <span class="va">myfileEditor</span> <span class="op">&lt;-</span> <span class="va">fileEditor</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">f</span><span class="op">)</span>

  <span class="fu"><a href="https://rdrr.io/r/base/readLines.html">readLines</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span>

  <span class="va">myfileEditor</span><span class="op">$</span><span class="fu">append_line</span><span class="op">(</span><span class="st">"Hi mom!"</span><span class="op">)</span>
  <span class="va">myfileEditor</span><span class="op">$</span><span class="fu">append_line</span><span class="op">(</span><span class="st">"It's a beautiful day!"</span><span class="op">)</span>

  <span class="fu"><a href="https://rdrr.io/r/base/readLines.html">readLines</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span>
<span class="op">}</span>

<span class="fu">greetMom</span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; [1] "Hi mom!"               "It's a beautiful day!"</span>

<span class="co"># force garbage collection</span>
<span class="fu"><a href="https://rdrr.io/r/base/gc.html">gc</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; [1] "Closing the file connection!"</span>
<span class="co">#&gt;           used (Mb) gc trigger  (Mb) limit (Mb) max used</span>
<span class="co">#&gt; Ncells 1186808 63.4    2271198 121.3         NA  2271198</span>
<span class="co">#&gt; Vcells 2073980 15.9    8388608  64.0      16384  3847332</span>
<span class="co">#&gt;         (Mb)</span>
<span class="co">#&gt; Ncells 121.3</span>
<span class="co">#&gt; Vcells  29.4</span></code></pre></div>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="s3.html"><span class="header-section-number">13</span> S3</a></div>
<div class="next"><a href="s4.html"><span class="header-section-number">15</span> S4</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#r6"><span class="header-section-number">14</span> R6</a></li>
<li><a class="nav-link" href="#exercises-14.2.6"><span class="header-section-number">14.1</span> Exercises 14.2.6</a></li>
<li><a class="nav-link" href="#exercises-14.3.3"><span class="header-section-number">14.2</span> Exercises 14.3.3</a></li>
<li><a class="nav-link" href="#exercises-14.4.4"><span class="header-section-number">14.3</span> Exercises 14.4.4</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/IndrajeetPatil/Advanced-R-exercises/blob/master/R6.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/IndrajeetPatil/Advanced-R-exercises/edit/master/R6.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Advanced R Exercises</strong>" was written by <a class="text-light" href="https://sites.google.com/site/indrajeetspatilmorality/">Indrajeet Patil</a>. It was last built on 2022-05-27.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
